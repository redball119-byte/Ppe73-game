<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ (ì§ˆë³‘ëª… ë‚™í•˜)</title>
  <style>
    :root{
      --bg:#071022;
      --card:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.72);
      --good:#22c55e;
      --bad:#ef4444;
      --btn:rgba(255,255,255,.10);
      --btn2:rgba(255,255,255,.16);
      --shadow: 0 14px 34px rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1100px 520px at 50% -10%, rgba(120,170,255,.20), transparent 55%),
                  radial-gradient(900px 420px at 50% 115%, rgba(0,255,255,.06), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    }
    .wrap{
      height:100svh;
      padding:12px 12px calc(12px + env(safe-area-inset-bottom));
      display:flex;
      flex-direction:column;
      gap:10px;
      max-width:520px;
      margin:0 auto;
    }

    .topRow{
      display:grid;
      grid-template-columns: 1.35fr 1fr 1fr;
      gap:10px;
    }
    .pill{
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:10px 12px;
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-height:54px;
    }
    .pill .t1{font-size:13px; font-weight:700; letter-spacing:.2px;}
    .pill .t2{font-size:12px; color:var(--muted)}
    .pill b{font-size:18px}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      padding:12px;
    }
    .title{
      font-size:16px;
      font-weight:800;
      line-height:1.25;
      margin:0 0 6px 0;
    }
    .desc{
      margin:0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
      word-break:keep-all;
    }

    /* ê²Œì„ ì˜ì—­: ëª¨ë°”ì¼ í•œ í™”ë©´ ë§ì¶¤ */
    .stageCard{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }
    .stageHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .badge{
      font-size:12px;
      color:var(--muted);
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      white-space:nowrap;
    }

    .stage{
      position:relative;
      flex:1;
      min-height:0;
      border-radius:16px;
      border:1px dashed rgba(255,255,255,.14);
      background:rgba(0,0,0,.10);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* ë–¨ì–´ì§€ëŠ” ì§ˆë³‘/ìƒí™© í…ìŠ¤íŠ¸ */
    .falling{
      position:absolute;
      top:-70px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
      padding:10px 12px;
      min-width:72%;
      max-width:92%;
      text-align:center;
      font-size:16px;   /* ê¸€ì”¨ ì‘ê²Œ */
      font-weight:800;
      line-height:1.2;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      user-select:none;
      pointer-events:none;
      word-break:keep-all;
    }
    .hintCenter{
      text-align:center;
      font-size:13px;
      color:rgba(234,240,255,.55);
      line-height:1.35;
      padding:0 10px;
    }

    /* ê²°ê³¼ ë°•ìŠ¤ */
    .resultBox{
      display:none;
      position:absolute;
      inset:10px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      padding:10px;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:8px;
      text-align:center;
    }
    .resultBox.show{display:flex;}
    .resultImg{
      width:120px;      /* âœ… ì´ë¯¸ì§€ ì‘ê²Œ */
      height:120px;     /* âœ… ì´ë¯¸ì§€ ì‘ê²Œ */
      object-fit:contain; /* âœ… ì „ì²´ ëª¸ì´ ë‚˜ì˜¤ê²Œ */
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
    }
    .resultTitle{
      font-size:18px; font-weight:900;
      margin-top:4px;
    }
    .resultText{
      font-size:12px; color:var(--muted);
      line-height:1.35;
      padding:0 6px;
      max-width: 360px;
      word-break:keep-all;
    }
    .btnRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      width:min(420px, 92%);
      margin-top:6px;
    }
    .btn{
      border:none;
      border-radius:16px;
      padding:14px 14px;
      font-size:16px;
      font-weight:900;
      color:var(--text);
      background:linear-gradient(180deg, rgba(80,140,255,.95), rgba(45,100,255,.78));
      box-shadow: 0 14px 28px rgba(0,0,0,.42);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:scale(.99)}
    .btnStart{
      background:linear-gradient(180deg, rgba(34,197,94,.92), rgba(34,197,94,.62));
    }

    /* ì„ íƒ ë²„íŠ¼ */
    .choices{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .choice{
      border:1px solid var(--stroke);
      border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.06));
      padding:12px 10px;
      min-height:64px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:4px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .choice .c1{font-size:15px; font-weight:900;}
    .choice .c2{font-size:11px; color:var(--muted); line-height:1.2}
    .choice:active{transform:scale(.99)}
    .choice.disabled{opacity:.45; pointer-events:none;}
    .footerNote{
      font-size:11px;
      color:rgba(234,240,255,.55);
      text-align:center;
      margin-top:2px;
    }

    /* ì‘ì€ í™”ë©´ ì¶”ê°€ ìµœì í™” */
    @media (max-height: 740px){
      .title{font-size:15px}
      .falling{font-size:15px; min-width:78%;}
      .resultImg{width:110px; height:110px;}
      .choice{min-height:60px}
      .btn{padding:13px}
    }
    @media (max-height: 690px){
      .pill b{font-size:16px}
      .pill .t1{font-size:12px}
      .falling{font-size:14px}
      .resultImg{width:100px; height:100px;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topRow">
      <div class="pill">
        <div>
          <div class="t1">ğŸ§¹ í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ</div>
          <div class="t2">ì§ˆë³‘ëª… ë‚™í•˜</div>
        </div>
      </div>
      <div class="pill">
        <div>
          <div class="t1">ë¬¸í•­</div>
          <div class="t2"><b id="qNow">0</b> / <b id="qTotal">10</b></div>
        </div>
      </div>
      <div class="pill">
        <div>
          <div class="t1">ì ìˆ˜</div>
          <div class="t2"><b id="score">0</b></div>
        </div>
      </div>
    </div>

    <div class="card">
      <p class="title">ì§ˆë³‘/ìƒí™©ì„ ë³´ê³  í•„ìš”í•œ PPEë¥¼ ê³ ë¥´ì„¸ìš”</p>
      <p class="desc">
        â‘  <b>ì‹œì‘</b>ì„ ëˆ„ë¥´ë©´ ì§ˆë³‘ëª…ì´ ìœ„ì—ì„œ <b>ì²œì²œíˆ</b> ë‚´ë ¤ì˜µë‹ˆë‹¤.
        â‘¡ ì•„ë˜ ë²„íŠ¼ì—ì„œ <b>PPE 1ê°œ</b>ë¥¼ ì„ íƒí•˜ë©´ ì±„ì  í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.
      </p>
    </div>

    <div class="card stageCard">
      <div class="stageHeader">
        <div class="badge">â³ ì œí•œì‹œê°„: <b id="timeLeft">8.0</b>s</div>
        <div class="badge" id="stateBadge">ëŒ€ê¸°ì¤‘</div>
      </div>

      <div class="stage" id="stage">
        <div class="hintCenter" id="hintCenter">
          ì‹œì‘ì„ ëˆ„ë¥´ë©´<br/>ì§ˆë³‘ëª…ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤
        </div>

        <div class="falling" id="falling" style="display:none;"></div>

        <div class="resultBox" id="resultBox" aria-live="polite">
          <img class="resultImg" id="resultImg" src="assets/idle.png" alt="result" />
          <div class="resultTitle" id="resultTitle">ëŒ€ê¸°</div>
          <div class="resultText" id="resultText"></div>
          <div class="btnRow">
            <button class="btn" id="nextBtn">ë‹¤ìŒ</button>
          </div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btn btnStart" id="startBtn">ì‹œì‘</button>
      </div>

      <div class="choices" id="choices">
        <div class="choice" data-ppe="mask">
          <div class="c1">ë§ˆìŠ¤í¬</div>
          <div class="c2">ê¸°ë³¸(ë¹„ë§/ë¶„ë¬´)</div>
        </div>
        <div class="choice" data-ppe="n95">
          <div class="c1">N95 ë§ˆìŠ¤í¬</div>
          <div class="c2">ê³µê¸°(ê²°í•µ ë“±)</div>
        </div>
        <div class="choice" data-ppe="gown_gloves">
          <div class="c1">ê°€ìš´+ì¥ê°‘</div>
          <div class="c2">ì ‘ì´‰(ì˜¤ì—¼ë¬¼ ì²˜ë¦¬)</div>
        </div>
        <div class="choice" data-ppe="none">
          <div class="c1">PPE ë¶ˆí•„ìš”</div>
          <div class="c2">ìœ„í—˜ ë‚®ìŒ(êµìœ¡ìš©)</div>
        </div>
      </div>

      <div class="footerNote">â€» êµìœ¡ìš© ë‹¨ìˆœí™” ë²„ì „ (ìƒí™©ë³„ í‘œì¤€ì£¼ì˜+ì¶”ê°€ì£¼ì˜ ê°œë… ê¸°ë°˜)</div>
    </div>
  </div>

<script>
(() => {
  // âœ… ë¬¸ì œ: ë–¨ì–´ì§€ëŠ” "ì§ˆë³‘/ìƒí™©" â†’ ì •ë‹µ PPE 1ê°œ
  // ppe: mask | n95 | gown_gloves | none
  const questions = [
    { text: "ì¸í”Œë£¨ì—”ì í™˜ì êµ¬ì—­ ì²­ì†Œ", ppe: "mask", explain: "ë¹„ë§/ë¶„ë¬´ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬" },
    { text: "ê²°í•µ(ì˜ì‹¬/í™•ì§„) ê²©ë¦¬ë³‘ì‹¤ ì£¼ë³€ í™˜ê²½ì •ë¦¬", ppe: "n95", explain: "ê³µê¸° ì „íŒŒ ìœ„í—˜ â†’ N95" },
    { text: "í˜ˆì•¡/ì²´ì•¡ ì˜¤ì—¼(Spill) ì²˜ë¦¬", ppe: "gown_gloves", explain: "ì²´ì•¡ ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
    { text: "C. difficile í™˜ì ë³‘ì‹¤ í™”ì¥ì‹¤ ì²­ì†Œ", ppe: "gown_gloves", explain: "ì ‘ì´‰ ì˜¤ì—¼ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
    { text: "ìˆ˜ë‘/í™ì—­(ì˜ì‹¬) ê²©ë¦¬êµ¬ì—­ ì¶œì… ì „", ppe: "n95", explain: "ê³µê¸° ì „íŒŒ ìœ„í—˜ â†’ N95" },
    { text: "ì¼ë°˜ ì‚¬ë¬´ì‹¤ ë°”ë‹¥ ë§ˆë¥¸ ë¨¼ì§€ ì²­ì†Œ(ì˜¤ì—¼ ì—†ìŒ)", ppe: "none", explain: "íŠ¹ì´ ì˜¤ì—¼ ìœ„í—˜ ë‚®ìŒ â†’ PPE ë¶ˆí•„ìš”" },
    { text: "êµ¬í† /ì„¤ì‚¬ ì˜¤ì—¼ë¬¼(ê°€ì‹œì ) ë‹¦ê¸°", ppe: "gown_gloves", explain: "ì˜¤ì—¼ë¬¼ ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
    { text: "ë§ˆìŠ¤í¬ ì°©ìš© í™˜ì ëŒ€ê¸°ê³µê°„ ì˜ì ì†Œë…", ppe: "mask", explain: "ê°€ê¹Œìš´ ë¹„ë§ ë…¸ì¶œ ê°€ëŠ¥ â†’ ë§ˆìŠ¤í¬" },
    { text: "MRSA/VRE ì¥ê¸°ì¬ì‹¤ ë³‘ì‹¤ í„°ë¯¸ë„ ì²­ì†Œ", ppe: "gown_gloves", explain: "ì ‘ì´‰ ì˜¤ì—¼ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
    { text: "ê²°í•µ í™˜ì ì‚¬ìš© í›„ êµ¬ì—­ í™˜ê¸°/ì •ë¦¬", ppe: "n95", explain: "ê³µê¸° ì „íŒŒ ìœ„í—˜ â†’ N95" },
  ];

  const total = questions.length;
  const els = {
    qNow: document.getElementById("qNow"),
    qTotal: document.getElementById("qTotal"),
    score: document.getElementById("score"),
    timeLeft: document.getElementById("timeLeft"),
    stateBadge: document.getElementById("stateBadge"),
    startBtn: document.getElementById("startBtn"),
    nextBtn: document.getElementById("nextBtn"),
    stage: document.getElementById("stage"),
    falling: document.getElementById("falling"),
    hintCenter: document.getElementById("hintCenter"),
    choices: document.getElementById("choices"),
    resultBox: document.getElementById("resultBox"),
    resultImg: document.getElementById("resultImg"),
    resultTitle: document.getElementById("resultTitle"),
    resultText: document.getElementById("resultText"),
  };

  els.qTotal.textContent = total;

  // ê²Œì„ ìƒíƒœ
  let idx = 0;
  let score = 0;
  let running = false;
  let answered = false;

  // ë‚™í•˜(ì†ë„/ì‹œê°„)
  const FALL_DURATION_MS = 5200; // âœ… ì²œì²œíˆ
  const TIME_LIMIT_MS = 8000;    // âœ… ì—¬ìœ 
  let fallStart = 0;
  let timerId = null;
  let rafId = null;

  function setBadge(text){
    els.stateBadge.textContent = text;
  }

  function setChoicesEnabled(on){
    const nodes = els.choices.querySelectorAll(".choice");
    nodes.forEach(n => {
      n.classList.toggle("disabled", !on);
    });
  }

  function showResult(kind, q, pickedPpe, reason){
    // kind: "good" | "bad" | "timeout"
    els.resultBox.classList.add("show");
    els.falling.style.display = "none";

    if(kind === "good"){
      els.resultImg.src = "assets/correct.png";
      els.resultTitle.textContent = "ì •ë‹µ âœ…";
    } else {
      els.resultImg.src = "assets/wrong.png";
      els.resultTitle.textContent = "ì˜¤ë‹µ âŒ";
    }

    const pickedLabel = labelOf(pickedPpe);
    const answerLabel = labelOf(q.ppe);

    els.resultText.textContent =
      `ë¬¸ì œ: ${q.text}\nì„ íƒ: ${pickedLabel}\nì •ë‹µ: ${answerLabel}\nì„¤ëª…: ${q.explain}`;

    setChoicesEnabled(false);
    els.startBtn.disabled = true;
    setBadge("ì±„ì ì™„ë£Œ");
  }

  function labelOf(ppe){
    switch(ppe){
      case "mask": return "ë§ˆìŠ¤í¬";
      case "n95": return "N95 ë§ˆìŠ¤í¬";
      case "gown_gloves": return "ê°€ìš´+ì¥ê°‘";
      case "none": return "PPE ë¶ˆí•„ìš”";
      default: return "-";
    }
  }

  function resetResultBox(){
    els.resultBox.classList.remove("show");
    els.resultImg.src = "assets/idle.png";
    els.resultTitle.textContent = "ëŒ€ê¸°";
    els.resultText.textContent = "";
  }

  function updateHud(){
    els.qNow.textContent = idx;
    els.score.textContent = score;
  }

  function endAll(){
    running = false;
    answered = true;
    cancelAnimationFrame(rafId);
    clearInterval(timerId);
    timerId = null;
    rafId = null;

    els.falling.style.display = "none";
    els.hintCenter.style.display = "block";
    els.hintCenter.innerHTML = `êµìœ¡ ì™„ë£Œ ğŸ‘<br/>ì ìˆ˜: <b>${score}</b> / ${total}`;
    els.startBtn.disabled = false;
    els.startBtn.textContent = "ì²˜ìŒë¶€í„° ë‹¤ì‹œ";
    setBadge("ì™„ë£Œ");
    setChoicesEnabled(false);
    resetResultBox();
    els.qNow.textContent = total;
  }

  function nextQuestion(){
    resetResultBox();

    if(idx >= total){
      endAll();
      return;
    }
    answered = false;
    running = false;

    els.startBtn.disabled = false;
    els.startBtn.textContent = "ì‹œì‘";
    setChoicesEnabled(false);

    els.hintCenter.style.display = "block";
    els.hintCenter.innerHTML = `ì‹œì‘ì„ ëˆ„ë¥´ë©´<br/>ì§ˆë³‘ëª…ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤`;
    els.timeLeft.textContent = (TIME_LIMIT_MS/1000).toFixed(1);
    setBadge("ëŒ€ê¸°ì¤‘");
  }

  function startFall(){
    if(idx >= total) return;
    if(running) return;

    running = true;
    answered = false;
    resetResultBox();
    setChoicesEnabled(true);

    els.hintCenter.style.display = "none";
    els.falling.style.display = "block";
    els.falling.textContent = questions[idx].text;
    els.falling.style.top = "-70px";

    fallStart = performance.now();
    setBadge("ì§„í–‰ì¤‘");
    els.startBtn.disabled = true;

    // ë‚™í•˜ ì• ë‹ˆë©”ì´ì…˜
    const stageRect = els.stage.getBoundingClientRect();
    const targetY = stageRect.height - 110; // ë°”ë‹¥ ê·¼ì²˜

    function tick(now){
      if(!running) return;

      const t = Math.min(1, (now - fallStart) / FALL_DURATION_MS);
      const y = (-70) + t * (targetY + 70);
      els.falling.style.top = y + "px";

      rafId = requestAnimationFrame(tick);

      // ë°”ë‹¥ ë„ë‹¬í–ˆëŠ”ë° ì•„ì§ ë‹µ ì•ˆí•¨ â†’ ì‹œê°„ì´ˆê³¼ ì²˜ë¦¬(ì˜¤ë‹µ)
      if(t >= 1 && !answered){
        onTimeout();
      }
    }
    rafId = requestAnimationFrame(tick);

    // ì œí•œì‹œê°„ í‘œì‹œ
    timerId = setInterval(() => {
      if(!running) return;
      const elapsed = performance.now() - fallStart;
      const left = Math.max(0, TIME_LIMIT_MS - elapsed);
      els.timeLeft.textContent = (left/1000).toFixed(1);

      if(left <= 0 && !answered){
        onTimeout();
      }
    }, 100);
  }

  function onTimeout(){
    if(answered) return;
    answered = true;
    running = false;
    cancelAnimationFrame(rafId);
    clearInterval(timerId);
    timerId = null;

    const q = questions[idx];
    showResult("bad", q, "ì„ íƒì—†ìŒ", "ì‹œê°„ì´ˆê³¼");
  }

  function answer(ppe){
    if(answered || !running) return;

    answered = true;
    running = false;
    cancelAnimationFrame(rafId);
    clearInterval(timerId);
    timerId = null;

    const q = questions[idx];
    const ok = (ppe === q.ppe);
    if(ok) score += 1;

    updateHud();
    showResult(ok ? "good" : "bad", q, ppe, "");
  }

  // ì´ë²¤íŠ¸
  els.startBtn.addEventListener("click", () => {
    // ì™„ë£Œ í›„ ë‹¤ì‹œ ì‹œì‘
    if(idx >= total){
      idx = 0;
      score = 0;
      updateHud();
      nextQuestion();
      return;
    }
    // ëŒ€ê¸° ìƒíƒœì—ì„œ ì‹œì‘
    startFall();
  });

  els.nextBtn.addEventListener("click", () => {
    // ê²°ê³¼ì°½ì—ì„œ ë‹¤ìŒ ë¬¸ì œ
    idx += 1;
    updateHud();
    nextQuestion();
  });

  els.choices.addEventListener("click", (e) => {
    const btn = e.target.closest(".choice");
    if(!btn) return;
    const ppe = btn.getAttribute("data-ppe");
    answer(ppe);
  });

  // ì´ˆê¸°
  idx = 0;
  score = 0;
  updateHud();
  nextQuestion();
})();
</script>
</body>
</html>
