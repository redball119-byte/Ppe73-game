<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ (ì§ˆë³‘ëª… ë‚™í•˜)</title>

  <style>
    :root{
      --bg:#071022;
      --card:rgba(255,255,255,.07);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.70);
      --good:#22c55e;
      --bad:#ef4444;
      --btn:#2b3b55;
      --btn2:#1f2c44;
      --shadow: 0 16px 38px rgba(0,0,0,.45);
      --r:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% 0%, rgba(255,255,255,.08), transparent 60%),
                  radial-gradient(1200px 700px at 80% 10%, rgba(34,197,94,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      overflow:hidden; /* âœ… í™”ë©´ ê³ ì • (í•œ í˜ì´ì§€) */
    }

    .wrap{
      height:100dvh;
      padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
      display:flex;
      flex-direction:column;
      gap:10px;
      max-width:520px;
      margin:0 auto;
    }

    .top{
      display:grid;
      grid-template-columns: 1.5fr 1fr 1fr;
      gap:10px;
      align-items:stretch;
    }
    .pill{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:10px 12px;
      box-shadow: var(--shadow);
      min-height:62px;
    }
    .title{
      font-weight:800;
      font-size:16px;
      line-height:1.15;
    }
    .subtitle{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
      line-height:1.25;
    }
    .big{
      font-weight:900;
      font-size:22px;
      margin-top:6px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      padding:12px;
    }
    .card h2{
      margin:0;
      font-size:18px;
      line-height:1.2;
      letter-spacing:-.2px;
    }
    .hint{
      margin-top:6px;
      font-size:12px;
      line-height:1.35;
      color:var(--muted);
    }

    /* âœ… ê²Œì„ ì˜ì—­: í¬ê²Œ */
    .game{
      flex: 1 1 auto;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0; /* flex overflow ë°©ì§€ */
    }
    .arena{
      position:relative;
      flex: 1 1 auto;
      min-height:0;
      border-radius: var(--r);
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(0,0,0,.12);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 8px;
    }
    .arena .placeholder{
      color: rgba(234,240,255,.28);
      font-weight:800;
      text-align:center;
      line-height:1.35;
      font-size:14px;
      padding: 14px;
    }

    /* ë–¨ì–´ì§€ëŠ” ì§ˆë³‘ëª… */
    .falling{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:-56px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      letter-spacing:-.2px;
      white-space:nowrap;
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
      pointer-events:none;
      font-size:16px;
    }

    /* ìƒíƒœ ë°” */
    .statusbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .tag{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      padding:7px 10px;
      font-size:12px;
      color:var(--muted);
      min-width: 120px;
      text-align:center;
    }

    /* ë²„íŠ¼ ì˜ì—­ */
    .controls{
      flex: 0 0 auto;
    }
    .controls h3{
      margin:0 0 8px 0;
      font-size:18px;
      letter-spacing:-.2px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    button{
      appearance:none;
      border:none;
      background: var(--btn);
      color: var(--text);
      border-radius: 18px;
      padding: 12px 10px;
      font-weight:900;
      letter-spacing:-.2px;
      box-shadow: 0 10px 24px rgba(0,0,0,.30);
      border:1px solid rgba(255,255,255,.12);
      touch-action: manipulation; /* âœ… ëª¨ë°”ì¼ í„°ì¹˜ ì•ˆì • */
      cursor:pointer;
      position:relative;
      z-index: 20; /* âœ… ì˜¤ë²„ë ˆì´ ìœ„ì—ì„œ ëˆŒë¦¼ */
    }
    button:active{ transform: translateY(1px); }
    button small{
      display:block;
      margin-top:4px;
      font-weight:700;
      font-size:12px;
      color: rgba(234,240,255,.70);
      line-height:1.2;
    }

    /* ì‹œì‘ ë²„íŠ¼: ë„ˆë¬´ í¬ì§€ ì•Šê²Œ */
    #startBtn{
      width:100%;
      background: linear-gradient(180deg, #42b96b, #2c8e55);
      border:1px solid rgba(255,255,255,.18);
      padding: 12px 10px;  /* âœ… ì¤„ì„ */
      font-size:18px;
      border-radius: 18px;
      margin-top: 8px;
    }
    #startBtn[disabled]{
      opacity:.55;
      filter:saturate(.7);
    }

    /* âœ… ê²°ê³¼ ëª¨ë‹¬(ì¤‘ìš”: ìˆ¨ê¹€ì€ display:none) */
    .hidden{ display:none !important; }

    #backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      z-index: 1000;
    }
    #modal{
      position:fixed;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%);
      width: min(92vw, 420px);
      background: rgba(9,18,38,.95);
      border:1px solid rgba(255,255,255,.16);
      border-radius: 22px;
      box-shadow: 0 24px 70px rgba(0,0,0,.6);
      padding: 14px 14px 12px 14px;
      z-index: 1001;
    }
    .modalHead{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-weight:1000;
      font-size:20px;
      margin-bottom:8px;
    }
    .modalImg{
      width: 110px;     /* âœ… ì´ë¯¸ì§€ ì‘ê²Œ */
      height: 110px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      object-fit: cover;
      display:block;
      margin: 0 auto 8px auto;
    }
    .modalText{
      font-size:12.5px;  /* âœ… ê¸€ì”¨ ì‘ê²Œ */
      color: rgba(234,240,255,.82);
      line-height:1.35;
      text-align:center;
      word-break: keep-all;
      overflow-wrap: anywhere; /* âœ… ì•ˆ ì˜ë¦¬ê³  ì¤„ë°”ê¿ˆ */
    }
    .modalText strong{ color: var(--text); }
    .good{ color: var(--good); }
    .bad{ color: var(--bad); }

    /* ì‘ì€ ì•ˆë‚´ */
    .foot{
      text-align:center;
      font-size:11.5px;
      color: rgba(234,240,255,.55);
      line-height:1.25;
      margin-top: 6px;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="top">
      <div class="pill">
        <div class="title">ğŸ§¹ í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ</div>
        <div class="subtitle">ê¸°ë³¸ 4ì¢… Â· ì§ˆë³‘ëª… ë‚™í•˜</div>
      </div>

      <div class="pill" style="text-align:center">
        <div class="subtitle">ë¬¸í•­</div>
        <div class="big"><span id="qNow">0</span>/<span id="qTotal">10</span></div>
      </div>

      <div class="pill" style="text-align:center">
        <div class="subtitle">ì ìˆ˜</div>
        <div class="big"><span id="score">0</span></div>
      </div>
    </div>

    <div class="card">
      <h2>ì§ˆë³‘/ìƒí™©ì„ ë³´ê³  í•„ìš”í•œ PPE 1ê°œë¥¼ ê³ ë¥´ì„¸ìš”</h2>
      <div class="hint">
        â‘  ì‹œì‘ì„ ëˆ„ë¥´ë©´ ì§ˆë³‘ëª…ì´ ìœ„ì—ì„œ ì²œì²œíˆ ë‚´ë ¤ì˜µë‹ˆë‹¤. <br>
        â‘¡ ì•„ë˜ì—ì„œ PPE 1ê°œë¥¼ ì„ íƒí•˜ë©´ <strong>ìë™ ì±„ì  í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</strong>
      </div>
    </div>

    <div class="game card">
      <div class="statusbar">
        <div class="tag">â³ ì œí•œì‹œê°„: <strong id="timeLeft">0.0s</strong></div>
        <div class="tag">ìƒíƒœ: <strong id="state">ëŒ€ê¸°</strong></div>
      </div>

      <div class="arena" id="arena">
        <div class="placeholder" id="placeholder">ì‹œì‘ì„ ëˆ„ë¥´ë©´<br>ì§ˆë³‘ëª…ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤</div>
        <div class="falling hidden" id="fallingLabel">ê²°í•µ</div>
      </div>

      <div class="controls">
        <h3>ë³´í˜¸êµ¬ ì„ íƒ (4ê°œ)</h3>

        <div class="grid">
          <button class="choice" data-key="mask">
            ë§ˆìŠ¤í¬
            <small>ê¸°ë³¸(ë¹„ë§/ë¶„ë¬´)</small>
          </button>
          <button class="choice" data-key="n95">
            N95 ë§ˆìŠ¤í¬
            <small>ê³µê¸°(ê²°í•µ ë“±)</small>
          </button>
          <button class="choice" data-key="gown_glove">
            ê°€ìš´+ì¥ê°‘
            <small>ì ‘ì´‰(ì˜¤ì—¼ë¬¼ ì²˜ë¦¬)</small>
          </button>
          <button class="choice" data-key="none">
            PPE ë¶ˆí•„ìš”
            <small>ìœ„í—˜ ë‚®ìŒ(êµìœ¡ìš©)</small>
          </button>
        </div>

        <button id="startBtn">ì‹œì‘</button>
        <div class="foot">â€» êµìœ¡ìš© ë‹¨ìˆœí™” ë²„ì „(í‘œì¤€ì£¼ì˜+ì¶”ê°€ì£¼ì˜ ê°œë… ê¸°ë°˜)</div>
      </div>
    </div>

  </div>

  <!-- âœ… ê²°ê³¼ ëª¨ë‹¬: ìˆ¨ê¹€ì€ display:none (í´ë¦­ ê°€ë¡œì±„ê¸° ë°©ì§€) -->
  <div id="backdrop" class="hidden"></div>
  <div id="modal" class="hidden" role="dialog" aria-modal="true">
    <div class="modalHead" id="modalHead">ì •ë‹µ âœ…</div>
    <img id="modalImg" class="modalImg" src="assets/idle.png" alt="result">
    <div class="modalText" id="modalText">ê²°ê³¼</div>
  </div>

  <script>
    /***********************
     * ë¬¸ì œì€í–‰ (ì›í•˜ë©´ ì—¬ê¸°ë§Œ ëŠ˜ë¦¬ë©´ ë¨)
     ***********************/
    const QUESTIONS = [
      { label:"ê²°í•µ í™˜ì ë³‘ì‹¤ ì²­ì†Œ", answer:"n95", explain:"ê³µê¸°ì£¼ì˜ â†’ N95 ë§ˆìŠ¤í¬" },
      { label:"ë…ê°(ì¸í”Œë£¨ì—”ì) êµ¬ì—­ ì²­ì†Œ", answer:"mask", explain:"ë¹„ë§ì£¼ì˜ ìƒí™© â†’ ë§ˆìŠ¤í¬" },
      { label:"êµ¬í† /ì„¤ì‚¬ ì˜¤ì—¼(ì²´ì•¡) ì²˜ë¦¬", answer:"gown_glove", explain:"ì²´ì•¡ ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
      { label:"í˜ˆì•¡/ì²´ì•¡ ì†ŒëŸ‰ ì˜¤ì—¼ ë‹¦ê¸°", answer:"gown_glove", explain:"ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
      { label:"ì¼ë°˜ ë³µë„(ì˜¤ì—¼ ì—†ìŒ) ë¨¼ì§€ ì •ë¦¬", answer:"none", explain:"ìœ„í—˜ ë‚®ìŒ â†’ PPE ë¶ˆí•„ìš”(êµìœ¡ìš©)" },
      { label:"ê²©ë¦¬ í™˜ì ë³‘ì‹¤ ì“°ë ˆê¸° ì •ë¦¬", answer:"gown_glove", explain:"ì ‘ì´‰ ê°€ëŠ¥ â†’ ê°€ìš´+ì¥ê°‘" },
      { label:"ê²°í•µ ì˜ì‹¬ í™˜ì êµ¬ì—­ ì²­ì†Œ", answer:"n95", explain:"ê³µê¸°ì£¼ì˜ ì˜ì‹¬ â†’ N95" },
      { label:"ê¸°ì¹¨ ì‹¬í•œ í™˜ì ì£¼ë³€ ì •ë¦¬", answer:"mask", explain:"ë¹„ë§ ë…¸ì¶œ ê°€ëŠ¥ â†’ ë§ˆìŠ¤í¬" },
      { label:"ì˜¤ì—¼ ë¦°ë„¨(ì²´ì•¡ ë¬»ìŒ) ì²˜ë¦¬", answer:"gown_glove", explain:"ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
      { label:"ì˜¤ì—¼ ì—†ëŠ” ì‚¬ë¬´ê³µê°„ ì •ë¦¬", answer:"none", explain:"ì˜ë£Œ ì˜¤ì—¼ ìœ„í—˜ ë‚®ìŒ â†’ PPE ë¶ˆí•„ìš”(êµìœ¡ìš©)" },
    ];

    const TOTAL = 10; // í™”ë©´ í‘œê¸°ìš© (ë¬¸ì œ ë°°ì—´ ê¸¸ì´ë‘ ê°™ê²Œ)
    document.getElementById('qTotal').textContent = TOTAL;

    /***********************
     * ìƒíƒœ
     ***********************/
    const arena = document.getElementById('arena');
    const placeholder = document.getElementById('placeholder');
    const fallingLabel = document.getElementById('fallingLabel');

    const qNowEl = document.getElementById('qNow');
    const scoreEl = document.getElementById('score');
    const timeLeftEl = document.getElementById('timeLeft');
    const stateEl = document.getElementById('state');

    const startBtn = document.getElementById('startBtn');
    const choiceBtns = Array.from(document.querySelectorAll('.choice'));

    const backdrop = document.getElementById('backdrop');
    const modal = document.getElementById('modal');
    const modalHead = document.getElementById('modalHead');
    const modalImg = document.getElementById('modalImg');
    const modalText = document.getElementById('modalText');

    let idx = 0;
    let score = 0;
    let running = false;
    let locked = false; // ë‹µ ì„ íƒ í›„ ì ê¸ˆ
    let timerId = null;
    let rafId = null;

    // ì‹œê°„/ì†ë„
    const FALL_DURATION_MS = 4500; // ì²œì²œíˆ ë–¨ì–´ì§€ëŠ” ì‹œê°„
    const SHOW_RESULT_MS = 700;    // ê²°ê³¼ì°½ ì ê¹ ë³´ì—¬ì£¼ê³  ìë™ ë‹¤ìŒ

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
    const order = shuffle(QUESTIONS).slice(0, TOTAL);

    function setHidden(el, yes){
      if(yes) el.classList.add('hidden');
      else el.classList.remove('hidden');
    }

    function showModal(isCorrect, q, pickedKey, timeout=false){
      setHidden(backdrop, false);
      setHidden(modal, false);

      if(isCorrect){
        modalHead.innerHTML = 'ì •ë‹µ <span class="good">âœ…</span>';
        modalImg.src = 'assets/correct.png';
      }else{
        modalHead.innerHTML = 'ì˜¤ë‹µ <span class="bad">âŒ</span>';
        modalImg.src = 'assets/wrong.png';
      }

      const pickedText = keyToText(pickedKey);
      const ansText = keyToText(q.answer);

      modalText.innerHTML =
        `<div><strong>ë¬¸ì œ:</strong> ${q.label}</div>` +
        `<div><strong>ì„ íƒ:</strong> ${timeout ? "ì„ íƒ ì—†ìŒ(ì‹œê°„ ì´ˆê³¼)" : pickedText}</div>` +
        `<div><strong>ì •ë‹µ:</strong> ${ansText}</div>` +
        `<div style="margin-top:6px;">ì„¤ëª…: ${q.explain}</div>`;
    }

    function hideModal(){
      setHidden(backdrop, true);
      setHidden(modal, true);
    }

    function keyToText(k){
      return ({
        mask:"ë§ˆìŠ¤í¬",
        n95:"N95 ë§ˆìŠ¤í¬",
        gown_glove:"ê°€ìš´+ì¥ê°‘",
        none:"PPE ë¶ˆí•„ìš”"
      })[k] || k;
    }

    function updateTop(){
      qNowEl.textContent = idx;
      scoreEl.textContent = score;
    }

    function resetArena(){
      fallingLabel.style.top = '-56px';
      setHidden(fallingLabel, true);
      placeholder.style.opacity = '1';
      placeholder.textContent = 'ì‹œì‘ì„ ëˆ„ë¥´ë©´\nì§ˆë³‘ëª…ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤';
    }

    function enableChoices(on){
      choiceBtns.forEach(b=>{
        b.disabled = !on;
        b.style.opacity = on ? '1' : '.55';
      });
    }

    function stopAll(){
      if(timerId){ clearInterval(timerId); timerId=null; }
      if(rafId){ cancelAnimationFrame(rafId); rafId=null; }
    }

    function startQuestion(){
      if(running) return;
      if(idx >= TOTAL){
        stateEl.textContent = 'ì™„ë£Œ';
        placeholder.textContent = `êµìœ¡ ì™„ë£Œ ğŸ‰\nì ìˆ˜: ${score}/${TOTAL}`;
        return;
      }

      running = true;
      locked = false;
      stateEl.textContent = 'ì§„í–‰';
      placeholder.style.opacity = '0';
      enableChoices(true);

      const q = order[idx];
      fallingLabel.textContent = q.label;
      setHidden(fallingLabel, false);

      const startTime = performance.now();
      const arenaRect = arena.getBoundingClientRect();
      const endY = arenaRect.height - 70; // ì•„ë˜ìª½ ì—¬ë°±

      function frame(now){
        const t = Math.min(1, (now - startTime) / FALL_DURATION_MS);
        const y = (-56) + (endY + 56) * t;
        fallingLabel.style.top = y + 'px';

        const leftMs = Math.max(0, FALL_DURATION_MS - (now - startTime));
        timeLeftEl.textContent = (leftMs/1000).toFixed(1) + 's';

        if(t < 1 && !locked){
          rafId = requestAnimationFrame(frame);
        }else if(!locked){
          // ì‹œê°„ ì´ˆê³¼ ì²˜ë¦¬
          locked = true;
          enableChoices(false);
          running = false;
          idx++;
          updateTop();
          showModal(false, q, 'none', true);
          setTimeout(()=>{
            hideModal();
            resetArena();
            startBtn.disabled = false;
            stateEl.textContent = 'ëŒ€ê¸°';
          }, SHOW_RESULT_MS);
        }
      }
      rafId = requestAnimationFrame(frame);
    }

    function answerWith(key){
      if(!running) return;
      if(locked) return;

      locked = true;
      enableChoices(false);
      running = false;

      stopAll();

      const q = order[idx];
      const correct = (key === q.answer);

      if(correct) score++;
      idx++;
      updateTop();

      showModal(correct, q, key, false);

      // âœ… ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ê²Œ: ê²°ê³¼ ì ê¹ ë³´ì—¬ì£¼ê³  ìë™
      setTimeout(()=>{
        hideModal();
        resetArena();
        stateEl.textContent = 'ëŒ€ê¸°';
        startBtn.disabled = false;
      }, SHOW_RESULT_MS);
    }

    function startGame(){
      // ì‹œì‘ ë²„íŠ¼ì€ "ë‹¤ìŒ ë¬¸ì œ ì‹œì‘" ì—­í• 
      startBtn.disabled = true;
      resetArena();
      startQuestion();
    }

    // âœ… ëª¨ë°”ì¼ì—ì„œ í´ë¦­ ì”¹í˜ ë°©ì§€: pointerdownë„ ë°›ê¸°
    startBtn.addEventListener('click', startGame);
    startBtn.addEventListener('pointerdown', (e)=>{ e.preventDefault(); startGame(); });

    choiceBtns.forEach(btn=>{
      const key = btn.dataset.key;
      btn.addEventListener('click', ()=> answerWith(key));
      btn.addEventListener('pointerdown', (e)=>{ e.preventDefault(); answerWith(key); });
    });

    // ì˜¤ë²„ë ˆì´ í´ë¦­ì€ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨(ë‹«í˜ë„ ìë™)
    backdrop.addEventListener('click', (e)=>{ e.preventDefault(); });

    // ì´ˆê¸°
    updateTop();
    enableChoices(false);
    resetArena();
    timeLeftEl.textContent = (FALL_DURATION_MS/1000).toFixed(1) + 's';
  </script>
</body>
</html>
