<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ (ì§ˆë³‘ëª… ë‚™í•˜)</title>
  <style>
    :root{
      --bg:#071022;
      --card:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.75);
      --good:#22c55e;
      --bad:#ef4444;
      --btn:#2b3b55;
      --btn2:#1f2c44;
      --shadow: 0 18px 40px rgba(0,0,0,.45);
      --r:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 30% 0%, rgba(120,160,255,.12), transparent 60%),
                  radial-gradient(1000px 700px at 100% 20%, rgba(255,255,255,.06), transparent 50%),
                  var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
      overflow:hidden;
    }
    .wrap{
      height: 100svh;
      padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
      max-width: 480px;
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .topRow{
      display:grid;
      grid-template-columns: 1.2fr .8fr .8fr;
      gap:10px;
    }
    .chip{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: 20px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      min-height:64px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:2px;
    }
    .chip .title{
      font-size:13px;
      opacity:.9;
      display:flex;
      align-items:center;
      gap:8px;
      line-height:1.1;
    }
    .chip .big{
      font-size:18px;
      font-weight:800;
      letter-spacing:-.02em;
      line-height:1.05;
    }
    .chip .small{
      font-size:12px;
      color:var(--muted);
      line-height:1.1;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }
    .help{
      padding:12px 12px;
      line-height:1.25;
    }
    .help .h1{
      font-size:18px;
      font-weight:900;
      letter-spacing:-.02em;
      margin-bottom:6px;
    }
    .help .h1 span{ color:#9cc3ff; }
    .help .p{
      font-size:12.5px;
      color:var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .play{
      flex: 1 1 auto;
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 260px;
    }
    .lane{
      position:relative;
      flex: 1 1 auto;
      border-radius: 18px;
      border:1px dashed rgba(255,255,255,.14);
      overflow:hidden;
      background: rgba(0,0,0,.15);
      min-height: 230px;
    }
    .laneHint{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 0 18px;
      font-weight:800;
      opacity:.35;
      font-size:16px;
      line-height:1.25;
      pointer-events:none;
    }

    /* ë–¨ì–´ì§€ëŠ” ì§ˆë³‘ í…ìŠ¤íŠ¸ */
    .drop{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top:-60px;
      padding: 10px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 16px 30px rgba(0,0,0,.35);
      font-weight:900;
      letter-spacing:-.02em;
      font-size:18px;
      text-align:center;
      white-space:nowrap;
      user-select:none;
      pointer-events:none;
    }
    .drop .sub{
      display:block;
      margin-top:4px;
      font-size:12px;
      font-weight:700;
      color: rgba(234,240,255,.85);
      opacity:.85;
    }

    .row2{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .pill{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      padding: 8px 10px;
      border-radius: 999px;
      font-size:12px;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .pill b{ color:var(--text); font-size:12.5px }
    .btnStart{
      width: 100%;
      border:0;
      border-radius: 18px;
      padding: 14px 14px;
      font-size:18px;
      font-weight:900;
      color:white;
      background: linear-gradient(180deg, rgba(34,197,94,.95), rgba(22,163,74,.90));
      box-shadow: 0 18px 35px rgba(0,0,0,.40);
      cursor:pointer;
    }
    .btnStart:active{ transform: scale(.99); }

    .choices{
      padding: 10px 10px 12px;
    }
    .choicesHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin: 2px 4px 10px;
      gap:10px;
    }
    .choicesHeader .left{
      font-weight:900;
      font-size:16px;
      letter-spacing:-.02em;
    }
    .choicesHeader .right{
      font-size:12px;
      color:var(--muted);
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      color: var(--text);
      border-radius: 18px;
      padding: 14px 12px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 14px 26px rgba(0,0,0,.25);
    }
    .btn:active{ transform: scale(.99); }
    .btn .sub{
      display:block;
      margin-top:4px;
      font-size:12px;
      font-weight:700;
      color: var(--muted);
    }
    .btn.disabled{
      opacity:.55;
      pointer-events:none;
      filter:saturate(.8);
    }

    /* ê²°ê³¼ ëª¨ë‹¬ */
    .modalBack{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal{
      width:min(420px, 92vw);
      border-radius: 24px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 24px 50px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalBody{
      padding: 14px 14px 12px;
      text-align:center;
    }
    .resultImg{
      width:100%;
      height: 150px;      /* âœ… ì´ë¯¸ì§€ ë„ˆë¬´ í¬ì§€ ì•Šê²Œ */
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      object-fit: contain; /* âœ… ì „ì²´ ëª¸ ë‚˜ì˜¤ê²Œ */
      display:block;
      margin-bottom: 10px;
    }
    .modalTitle{
      font-size:22px;
      font-weight:1000;
      letter-spacing:-.03em;
      margin-bottom:6px;
    }
    .modalText{
      font-size:12.5px;   /* âœ… ê¸€ì”¨ ì‘ê²Œ */
      color: var(--muted);
      line-height:1.35;
      word-break:keep-all;
    }

    /* ì‘ì€ ì•ˆë‚´ */
    .foot{
      font-size:11.5px;
      color: rgba(234,240,255,.55);
      text-align:center;
      padding-bottom: 2px;
    }

    @media (max-height: 740px){
      .help .h1{ font-size:17px; }
      .drop{ font-size:17px; }
      .resultImg{ height: 135px; }
      .btnStart{ padding: 12px 14px; font-size:17px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topRow">
      <div class="chip">
        <div class="title">ğŸ§¹ í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ</div>
        <div class="big" id="modeName">ê¸°ë³¸ 3ì¢…</div>
        <div class="small">ì§ˆë³‘ëª… ë‚™í•˜</div>
      </div>
      <div class="chip" style="text-align:center">
        <div class="title" style="justify-content:center">ë¬¸í•­</div>
        <div class="big"><span id="qNow">0</span> / <span id="qTotal">10</span></div>
        <div class="small">ì§„í–‰</div>
      </div>
      <div class="chip" style="text-align:center">
        <div class="title" style="justify-content:center">ì ìˆ˜</div>
        <div class="big" id="score">0</div>
        <div class="small">â³ <span id="timeLeft">0.0</span>s</div>
      </div>
    </div>

    <div class="card help">
      <div class="h1">ì§ˆë³‘/ìƒí™©ì„ ë³´ê³  í•„ìš”í•œ <span>PPE 1ê°œ</span>ë¥¼ ê³ ë¥´ì„¸ìš”</div>
      <div class="p">
        <span>â‘  ì‹œì‘ì„ ëˆ„ë¥´ë©´ ì§ˆë³‘ëª…ì´ <b>ìœ„ì—ì„œ ì²œì²œíˆ</b> ë‚´ë ¤ì˜µë‹ˆë‹¤.</span>
        <span>â‘¡ ì•„ë˜ ë²„íŠ¼ì—ì„œ PPE 1ê°œë¥¼ ì„ íƒí•˜ë©´ <b>ìë™ ì±„ì </b> í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</span>
      </div>
    </div>

    <div class="card play">
      <div class="row2">
        <div class="pill">â³ ì œí•œì‹œê°„: <b id="limitText">4.5s</b></div>
        <div class="pill">ìƒíƒœ: <b id="statusText">ëŒ€ê¸°</b></div>
      </div>

      <div class="lane" id="lane">
        <div class="laneHint" id="laneHint">ì‹œì‘ì„ ëˆ„ë¥´ë©´<br/>ì§ˆë³‘ëª…ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤</div>
        <!-- ë–¨ì–´ì§€ëŠ” í…ìŠ¤íŠ¸ê°€ JSë¡œ ìƒì„±ë¨ -->
      </div>

      <button class="btnStart" id="btnStart">ì‹œì‘</button>
    </div>

    <div class="card choices">
      <div class="choicesHeader">
        <div class="left">ë³´í˜¸êµ¬ ì„ íƒ (4ê°œ)</div>
        <div class="right">í•œ ë¬¸ì œë‹¹ 1ê°œë§Œ ì„ íƒ</div>
      </div>
      <div class="grid">
        <button class="btn" data-ppe="mask">ë§ˆìŠ¤í¬<span class="sub">ê¸°ë³¸(ë¹„ë§/ë¶„ë¬´)</span></button>
        <button class="btn" data-ppe="n95">N95 ë§ˆìŠ¤í¬<span class="sub">ê³µê¸°(ê²°í•µ ë“±)</span></button>
        <button class="btn" data-ppe="gown_gloves">ê°€ìš´+ì¥ê°‘<span class="sub">ì ‘ì´‰(ì˜¤ì—¼ë¬¼ ì²˜ë¦¬)</span></button>
        <button class="btn" data-ppe="none">PPE ë¶ˆí•„ìš”<span class="sub">ìœ„í—˜ ë‚®ìŒ(êµìœ¡ìš©)</span></button>
      </div>
    </div>

    <div class="foot">â€» êµìœ¡ìš© ë‹¨ìˆœí™” ë²„ì „ (í‘œì¤€ì£¼ì˜+ì¶”ê°€ì£¼ì˜ ê°œë… ê¸°ë°˜)</div>
  </div>

  <!-- ê²°ê³¼ ëª¨ë‹¬ -->
  <div class="modalBack" id="modalBack">
    <div class="modal">
      <div class="modalBody">
        <img id="resultImg" class="resultImg" alt="result" src="assets/idle.png" />
        <div class="modalTitle" id="modalTitle">ê²°ê³¼</div>
        <div class="modalText" id="modalText">-</div>
      </div>
    </div>
  </div>

<script>
/** =========================
 *  ì„¤ì •
 * ========================= */
const TOTAL_QUESTIONS = 10;

// âœ… ì´ë¯¸ì§€ íŒŒì¼(ê¹ƒí—™ì— ì´ë¯¸ ì˜¬ë ¤ë‘” ê²½ë¡œ)
const IMG_IDLE    = "assets/idle.png";
const IMG_CORRECT = "assets/correct.png";
const IMG_WRONG   = "assets/wrong.png";

// âœ… ìë™ ë‹¤ìŒë¬¸ì œë¡œ ë„˜ì–´ê°€ëŠ” ì‹œê°„(ë°€ë¦¬ì´ˆ)
const AUTO_NEXT_MS = 900;   // 0.9ì´ˆ

// âœ… ë–¨ì–´ì§€ëŠ” ì†ë„(ìˆ«ì ì»¤ì§ˆìˆ˜ë¡ ëŠë¦¼)
//    1ì´ˆì— ëª‡ px ì›€ì§ì¼ì§€ë¡œ ê³„ì‚° (ë‚®ì„ìˆ˜ë¡ ëŠë¦¼)
const FALL_PX_PER_SEC = 110; // ëŠë¦¬ê²Œ(ì›í•˜ë©´ 90~140 ì¡°ì ˆ)

// âœ… ì œí•œì‹œê°„(ì´ˆ)
const LIMIT_SEC = 4.5;

/** =========================
 *  ë¬¸ì œ(ì§ˆë³‘/ìƒí™©) â†’ ì •ë‹µ PPE
 *  PPE í‚¤: mask / n95 / gown_gloves / none
 * ========================= */
const QUESTIONS = [
  { text:"ì¸í”Œë£¨ì—”ì í™˜ì êµ¬ì—­ ì²­ì†Œ", hint:"ë¹„ë§ ìœ„í—˜ â†’ ìˆ˜ìˆ ë§ˆìŠ¤í¬", answer:"mask", explain:"ë¹„ë§/ë¶„ë¬´ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬" },
  { text:"ê²°í•µ ì˜ì‹¬/í™•ì§„ ë³‘ì‹¤ ì²­ì†Œ", hint:"ê³µê¸°ì£¼ì˜ â†’ N95", answer:"n95", explain:"ê³µê¸°(ë¹„ë§í•µ) ìœ„í—˜ â†’ N95 ë§ˆìŠ¤í¬" },
  { text:"ìƒì²˜ ë°°ë†/ì‚¼ì¶œë¬¼ ì£¼ë³€ ì²­ì†Œ", hint:"ì²´ì•¡ ì ‘ì´‰ â†’ ê°€ìš´+ì¥ê°‘", answer:"gown_gloves", explain:"ì²´ì•¡/ì˜¤ì—¼ë¬¼ ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘" },
  { text:"í˜ˆì•¡/ì²´ì•¡ ì˜¤ì—¼ë¬¼(ìŠ¤í•„) ì²˜ë¦¬", hint:"ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘", answer:"gown_gloves", explain:"ì˜¤ì—¼ë¬¼ ì²˜ë¦¬ â†’ ê°€ìš´+ì¥ê°‘" },
  { text:"ê²©ë¦¬í•´ì œ í›„ ì¼ë°˜ ë³‘ì‹¤ ë°”ë‹¥ ì²­ì†Œ", hint:"ìœ„í—˜ ë‚®ìŒ(êµìœ¡ìš©) â†’ PPE ë¶ˆí•„ìš”", answer:"none", explain:"êµìœ¡ìš© ë‹¨ìˆœí™”: ìœ„í—˜ ë‚®ìŒ â†’ PPE ë¶ˆí•„ìš”" },
  { text:"í˜¸í¡ê¸° ì¦ìƒ í™˜ì ëŒ€ê¸°êµ¬ì—­ ì²­ì†Œ", hint:"ë¹„ë§ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬", answer:"mask", explain:"ë¹„ë§/ë¶„ë¬´ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬" },
  { text:"MRSA/VRE ë³‘ì‹¤ í™˜ê²½ ì²­ì†Œ", hint:"ì ‘ì´‰ ìœ„í—˜ â†’ ê°€ìš´+ì¥ê°‘", answer:"gown_gloves", explain:"ì ‘ì´‰ì£¼ì˜ ìƒí™© â†’ ê°€ìš´+ì¥ê°‘" },
  { text:"ì—ì–´ë¡œì¡¸ ë°œìƒ ê°€ëŠ¥ êµ¬ì—­(ê²°í•µ í™˜ê¸°ë¶ˆëŸ‰)", hint:"ê³µê¸° ìœ„í—˜ â†’ N95", answer:"n95", explain:"ê³µê¸° ë…¸ì¶œ ìœ„í—˜ â†’ N95 ë§ˆìŠ¤í¬" },
  { text:"êµ¬í† /ì„¤ì‚¬ í™˜ì í™”ì¥ì‹¤ ì²­ì†Œ(ì˜¤ì—¼ë¬¼ ì—†ìŒ)", hint:"ì ‘ì´‰ ê°€ëŠ¥ì„± ë‚®ìŒ(êµìœ¡ìš©) â†’ PPE ë¶ˆí•„ìš”", answer:"none", explain:"êµìœ¡ìš© ë‹¨ìˆœí™”: ì˜¤ì—¼ë¬¼ ì—†ìœ¼ë©´ ìœ„í—˜ ë‚®ìŒ â†’ PPE ë¶ˆí•„ìš”" },
  { text:"ë¶„ë¹„ë¬¼ ë§ì€ í™˜ì ì¹¨ìƒ ì£¼ë³€ ì²­ì†Œ", hint:"ë¹„ë§/ë¶„ë¬´ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬", answer:"mask", explain:"ë¹„ë§/ë¶„ë¬´ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬" },
];

/** =========================
 *  ìƒíƒœ
 * ========================= */
const els = {
  qNow: document.getElementById("qNow"),
  qTotal: document.getElementById("qTotal"),
  score: document.getElementById("score"),
  timeLeft: document.getElementById("timeLeft"),
  limitText: document.getElementById("limitText"),
  statusText: document.getElementById("statusText"),
  lane: document.getElementById("lane"),
  laneHint: document.getElementById("laneHint"),
  btnStart: document.getElementById("btnStart"),
  modalBack: document.getElementById("modalBack"),
  resultImg: document.getElementById("resultImg"),
  modalTitle: document.getElementById("modalTitle"),
  modalText: document.getElementById("modalText"),
};
els.qTotal.textContent = TOTAL_QUESTIONS;
els.limitText.textContent = LIMIT_SEC.toFixed(1) + "s";
els.resultImg.src = IMG_IDLE;

let order = [];          // ë¬¸ì œ ìˆœì„œ
let idx = -1;            // í˜„ì¬ ì¸ë±ìŠ¤
let score = 0;
let running = false;     // ë–¨ì–´ì§€ëŠ” ì¤‘?
let answered = false;
let dropEl = null;

let rafId = null;
let startTs = 0;
let lastTs = 0;
let elapsed = 0;
let remaining = LIMIT_SEC;

let autoNextTimer = null;

/** =========================
 *  ìœ í‹¸
 * ========================= */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function setButtonsDisabled(disabled){
  document.querySelectorAll(".btn[data-ppe]").forEach(b=>{
    b.classList.toggle("disabled", disabled);
  });
}

function openModal(imgSrc, title, text){
  els.resultImg.src = imgSrc;
  els.modalTitle.textContent = title;
  els.modalText.textContent = text;
  els.modalBack.style.display = "flex";
}

function closeModal(){
  els.modalBack.style.display = "none";
  els.resultImg.src = IMG_IDLE;
}

/** =========================
 *  ê²Œì„ íë¦„
 * ========================= */
function initGame(){
  order = shuffle([...Array(QUESTIONS.length).keys()]).slice(0, TOTAL_QUESTIONS);
  idx = -1;
  score = 0;
  els.score.textContent = "0";
  els.qNow.textContent = "0";
  els.statusText.textContent = "ëŒ€ê¸°";
  els.timeLeft.textContent = LIMIT_SEC.toFixed(1);
  els.laneHint.style.display = "flex";
  closeModal();
  stopDrop();
  setButtonsDisabled(true);
  els.btnStart.disabled = false;
  els.btnStart.textContent = "ì‹œì‘";
}

function nextQuestion(){
  // ë
  if(idx + 1 >= TOTAL_QUESTIONS){
    running = false;
    answered = true;
    setButtonsDisabled(true);
    els.statusText.textContent = "ì™„ë£Œ";
    els.laneHint.style.display = "flex";
    els.laneHint.innerHTML = `êµìœ¡ ì™„ë£Œ ğŸ‘<br/>ì ìˆ˜: ${score}`;
    els.btnStart.textContent = "ë‹¤ì‹œ ì‹œì‘";
    els.btnStart.disabled = false;
    return;
  }

  idx += 1;
  answered = false;
  running = false;

  els.qNow.textContent = String(idx + 1);
  els.statusText.textContent = "ëŒ€ê¸°";
  els.timeLeft.textContent = LIMIT_SEC.toFixed(1);

  // ë ˆì¸ ì´ˆê¸°í™”
  els.lane.innerHTML = `<div class="laneHint" id="laneHint">ì‹œì‘ì„ ëˆ„ë¥´ë©´<br/>ì§ˆë³‘ëª…ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤</div>`;
  els.laneHint = document.getElementById("laneHint");
  els.laneHint.style.display = "flex";

  closeModal();
  setButtonsDisabled(true);

  els.btnStart.textContent = "ì‹œì‘";
  els.btnStart.disabled = false;
}

function startDrop(){
  if(running) return;
  // ë¬¸ì œ ì—†ìœ¼ë©´ ì²« ë¬¸ì œ
  if(idx < 0) nextQuestion();

  const q = QUESTIONS[order[idx]];
  answered = false;
  running = true;
  remaining = LIMIT_SEC;
  elapsed = 0;
  startTs = performance.now();
  lastTs = startTs;

  // ë“œë¡­ ì—˜ë¦¬ë¨¼íŠ¸
  dropEl = document.createElement("div");
  dropEl.className = "drop";
  dropEl.innerHTML = `${q.text}<span class="sub">${q.hint}</span>`;
  dropEl.style.top = "-70px";
  els.lane.appendChild(dropEl);

  els.laneHint.style.display = "none";
  els.statusText.textContent = "ì§„í–‰ì¤‘";
  setButtonsDisabled(false);
  els.btnStart.disabled = true; // ì§„í–‰ ì¤‘ ì‹œì‘ë²„íŠ¼ ì ê¸ˆ

  rafId = requestAnimationFrame(tick);
}

function stopDrop(){
  running = false;
  if(rafId) cancelAnimationFrame(rafId);
  rafId = null;
  if(dropEl && dropEl.parentNode) dropEl.parentNode.removeChild(dropEl);
  dropEl = null;
}

function tick(ts){
  if(!running) return;

  const dt = (ts - lastTs) / 1000;
  lastTs = ts;

  elapsed = (ts - startTs) / 1000;
  remaining = Math.max(0, LIMIT_SEC - elapsed);
  els.timeLeft.textContent = remaining.toFixed(1);

  // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
  const laneRect = els.lane.getBoundingClientRect();
  const maxTop = laneRect.height - 70; // ë°”ë‹¥ ê·¼ì²˜
  const y = Math.min(maxTop, (-70 + elapsed * FALL_PX_PER_SEC));
  if(dropEl) dropEl.style.top = y + "px";

  // ì‹œê°„ ì´ˆê³¼
  if(remaining <= 0){
    handleTimeout();
    return;
  }

  rafId = requestAnimationFrame(tick);
}

/** =========================
 *  ì±„ì  & ìë™ ë‹¤ìŒ
 * ========================= */
function scheduleAutoNext(){
  clearTimeout(autoNextTimer);
  autoNextTimer = setTimeout(()=>{
    closeModal();
    stopDrop();
    // ë‹¤ìŒ ë¬¸ì œë¡œ ìë™
    nextQuestion();
  }, AUTO_NEXT_MS);
}

function handleAnswer(ppeKey){
  if(!running || answered) return;
  answered = true;

  const q = QUESTIONS[order[idx]];
  const correct = (ppeKey === q.answer);

  if(correct) score += 1;

  els.score.textContent = String(score);
  els.statusText.textContent = correct ? "ì •ë‹µ" : "ì˜¤ë‹µ";

  setButtonsDisabled(true);

  // ê²°ê³¼ í‘œì‹œ (ì´ë¯¸ì§€ ì‘ê²Œ + contain)
  const title = correct ? "ì •ë‹µ âœ…" : "ì˜¤ë‹µ âŒ";
  const img = correct ? IMG_CORRECT : IMG_WRONG;

  // í…ìŠ¤íŠ¸ ë„ˆë¬´ ê¸¸ë©´ ì¤„ ë°”ê¿ˆë˜ë„ë¡ ì‘ì„±
  const txt =
    `ë¬¸ì œ: ${q.text}\n` +
    `ì„ íƒ: ${labelOf(ppeKey)}\n` +
    `ì •ë‹µ: ${labelOf(q.answer)}\n` +
    `ì„¤ëª…: ${q.explain}`;

  openModal(img, title, txt);

  // âœ… ìë™ ë‹¤ìŒ
  scheduleAutoNext();
}

function handleTimeout(){
  if(answered) return;
  answered = true;
  running = false;

  const q = QUESTIONS[order[idx]];
  setButtonsDisabled(true);
  els.statusText.textContent = "ì‹œê°„ì´ˆê³¼";

  const txt =
    `ë¬¸ì œ: ${q.text}\n` +
    `ì„ íƒ: ì—†ìŒ(ì‹œê°„ì´ˆê³¼)\n` +
    `ì •ë‹µ: ${labelOf(q.answer)}\n` +
    `ì„¤ëª…: ${q.explain}`;

  openModal(IMG_WRONG, "ì˜¤ë‹µ âŒ", txt);

  // âœ… ìë™ ë‹¤ìŒ
  scheduleAutoNext();
}

/** =========================
 *  ë¼ë²¨
 * ========================= */
function labelOf(key){
  switch(key){
    case "mask": return "ë§ˆìŠ¤í¬";
    case "n95": return "N95 ë§ˆìŠ¤í¬";
    case "gown_gloves": return "ê°€ìš´+ì¥ê°‘";
    case "none": return "PPE ë¶ˆí•„ìš”";
    default: return key;
  }
}

/** =========================
 *  ì´ë²¤íŠ¸
 * ========================= */
document.getElementById("btnStart").addEventListener("click", ()=>{
  // ì™„ë£Œ ìƒíƒœë©´ ì¬ì‹œì‘
  if(idx + 1 >= TOTAL_QUESTIONS){
    initGame();
    nextQuestion();
    return;
  }
  // ì²« ì‹œì‘ì´ë©´ ë‹¤ìŒë¬¸ì œ ì¤€ë¹„ í›„ ì‹œì‘
  if(idx < 0){
    nextQuestion();
  }
  startDrop();
});

document.querySelectorAll(".btn[data-ppe]").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const key = btn.getAttribute("data-ppe");
    handleAnswer(key);
  });
});

// ëª¨ë‹¬ í´ë¦­í•´ë„ ë‹«ì§€ ì•ŠìŒ(ìë™ ë„˜ì–´ê°€ê²Œ ìœ ì§€)
// í•„ìš”í•˜ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ:
// els.modalBack.addEventListener("click", closeModal);

/** =========================
 *  ì‹œì‘
 * ========================= */
initGame();
</script>
</body>
</html>
```î¨0î¨‚
