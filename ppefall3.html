<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ (ê¸°ë³¸ 4ì¢… Â· ì§ˆë³‘ëª… ë‚™í•˜)</title>
  <style>
    :root{
      --bg:#071022;
      --card:rgba(255,255,255,.07);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.75);
      --muted2:rgba(234,240,255,.55);
      --good:#22c55e;
      --bad:#ef4444;
      --shadow:0 18px 40px rgba(0,0,0,.45);
      --r:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 900px at 50% -200px, rgba(80,160,255,.20), transparent 55%),
                 radial-gradient(800px 600px at 80% 10%, rgba(34,197,94,.12), transparent 55%),
                 var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Pretendard", "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      -webkit-font-smoothing:antialiased;
      text-align:center;
    }

    .wrap{
      max-width: 430px;
      margin: 0 auto;
      padding: 18px 14px 18px;
      padding-bottom: calc(18px + env(safe-area-inset-bottom));
      min-height: 100svh;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .topRow{
      display:grid;
      grid-template-columns: 1.2fr .8fr .8fr;
      gap: 12px;
    }
    .tile{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 14px 12px;
      text-align:left;
    }
    .tile b{display:block; font-size: 18px; letter-spacing:-.3px}
    .tile small{display:block; color:var(--muted2); margin-top:4px; font-size: 12px; line-height:1.25}
    .tile.center{text-align:center}
    .tile.center b{font-size: 22px}
    .tile.center small{font-size: 12px}

    /* ì•ˆë‚´ ë°•ìŠ¤ */
    .guide{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--r);
      padding: 14px 14px 12px;
      box-shadow: var(--shadow);
      text-align:left;
    }
    .guide h2{
      margin:0 0 8px;
      font-size: 18px;
      letter-spacing:-.4px;
    }
    .guide ol{
      margin:0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.45;
    }

    /* ìƒíƒœ ì¤„ */
    .statusRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .pill{
      background: rgba(255,255,255,.05);
      border:1px solid var(--stroke);
      border-radius: 999px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-height: 44px;
    }
    .pill .k{color:var(--muted2); font-size: 12px}
    .pill .v{font-weight:800; font-size: 16px; letter-spacing:-.2px}

    /* ë‚™í•˜ ì˜ì—­: ë” í¬ê²Œ / ì•„ë˜ ë³´í˜¸êµ¬ ê³µê°„ í™•ë³´ */
    .dropArea{
      position:relative;
      flex: 1 1 auto;
      min-height: 240px;
      background: rgba(255,255,255,.04);
      border:1px dashed rgba(255,255,255,.18);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .fallLabel{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      top:-70px;
      width: 92%;
      max-width: 360px;
      padding: 16px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      font-weight: 900;
      letter-spacing: -0.6px;
      font-size: 28px;     /* ê°ì—¼ë³‘ ê¸€ì”¨ í¬ê¸° */
      line-height: 1.05;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* ê²°ê³¼ ì˜¤ë²„ë ˆì´(ì„¤ëª… í…ìŠ¤íŠ¸ ì œê±° ë²„ì „) */
    .resultOverlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      pointer-events:none;  /* ë²„íŠ¼ í´ë¦­ ë°©í•´ X */
    }
    .resultCard{
      width: 92%;
      max-width: 380px;
      background: rgba(0,0,0,.30);
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--r);
      padding: 16px 14px;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 10px;
    }
    .badge{
      font-weight: 900;
      font-size: 26px;
      letter-spacing: -.5px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge.good{color: var(--good)}
    .badge.bad{color: var(--bad)}
    .resultImg{
      width: 120px;   /* ì´ë¯¸ì§€ ì¡°ê¸ˆ ì‘ê²Œ */
      height: 120px;
      object-fit: contain;
      display:block;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.45));
    }
    .subhint{
      color: var(--muted2);
      font-size: 12px;
      line-height:1.3;
    }

    /* í•˜ë‹¨ ì˜ì—­ */
    .bottom{
      margin-top: 4px;
      background: transparent;
    }

    .bottomHead{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      padding: 2px 2px 6px;
    }
    .bottomHead .t{
      font-size: 22px;
      font-weight: 900;
      letter-spacing:-.4px;
    }
    .bottomHead .s{
      color: var(--muted2);
      font-size: 12px;
    }

    /* ë²„íŠ¼ 4ê°œ: í™”ë©´ ë‹µë‹µí•˜ì§€ ì•Šê²Œ ì‚´ì§ ì‘ê²Œ */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    button{
      border:none;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      padding: 14px 12px;
      color: var(--text);
      font-family: inherit;
      box-shadow: var(--shadow);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{transform: scale(.99)}
    .opt b{display:block; font-size: 18px; letter-spacing:-.3px}
    .opt small{display:block; margin-top:6px; color: var(--muted2); font-size: 12px}

    /* ì»¨íŠ¸ë¡¤ ì¤„: ì¬ì‹œì‘ ë²„íŠ¼ */
    .controls{
      margin-top: 10px;
      display:flex;
      justify-content:center;
      gap: 10px;
    }
    .mini{
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 14px;
      background: rgba(255,255,255,.10);
    }

    .foot{
      margin-top: 10px;
      color: var(--muted2);
      font-size: 12px;
    }

    /* ì•„ì£¼ ì‘ì€ í™”ë©´ì—ì„œ ë” ì¶•ì†Œ */
    @media (max-height: 740px){
      .fallLabel{font-size: 24px}
      .dropArea{min-height: 220px}
      .opt b{font-size: 16px}
      button{padding: 12px 10px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topRow">
      <div class="tile">
        <b>ğŸ§¹ í™˜ê²½ê´€ë¦¬ PPE í€´ì¦ˆ</b>
        <small>ê¸°ë³¸ 4ì¢… Â· ì§ˆë³‘ëª… ë‚™í•˜</small>
      </div>
      <div class="tile center">
        <small>ë¬¸í•­</small>
        <b id="qStat">0/10</b>
      </div>
      <div class="tile center">
        <small>ì ìˆ˜</small>
        <b id="score">0</b>
      </div>
    </div>

    <div class="guide">
      <h2>ì§ˆë³‘/ìƒí™©ì„ ë³´ê³  í•„ìš”í•œ PPE 1ê°œë¥¼ ê³ ë¥´ì„¸ìš”</h2>
      <ol>
        <li>ì§ˆë³‘ëª…ì´ ë„¤ëª¨ì¹¸ ìœ„ì—ì„œ ì•„ë˜ë¡œ <b>5ì´ˆ</b> ë™ì•ˆ ë‚´ë ¤ì˜µë‹ˆë‹¤. (ì‹œê°„ ì´ˆê³¼ ì‹œ ì˜¤ë‹µ)</li>
        <li>ì•„ë˜ ë²„íŠ¼ì—ì„œ PPE 1ê°œë¥¼ ì„ íƒí•˜ë©´ <b>ìë™ ì±„ì </b> í›„ <b>ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ</b>ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</li>
        <li><b>ì¬ì‹œì‘</b> ë²„íŠ¼ìœ¼ë¡œ ì–¸ì œë“  ì²˜ìŒë¶€í„° ë‹¤ì‹œí•  ìˆ˜ ìˆì–´ìš”.</li>
      </ol>
    </div>

    <div class="statusRow">
      <div class="pill">
        <span class="k">â³ ì œí•œì‹œê°„</span>
        <span class="v" id="timeLeft">5.0s</span>
      </div>
      <div class="pill">
        <span class="k">ìƒíƒœ</span>
        <span class="v" id="state">ëŒ€ê¸°</span>
      </div>
    </div>

    <div class="dropArea" id="dropArea">
      <div class="fallLabel" id="fallLabel">ì‹œì‘ ì—†ì´ ìë™ ì§„í–‰</div>

      <!-- ê²°ê³¼ ì˜¤ë²„ë ˆì´ (ì„¤ëª… í…ìŠ¤íŠ¸ ì œê±°) -->
      <div class="resultOverlay" id="resultOverlay">
        <div class="resultCard">
          <div class="badge good" id="badge">ì •ë‹µ âœ…</div>
          <img id="resultImg" class="resultImg" alt="result" src="assets/idle.png">
          <div class="subhint" id="subhint">ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤â€¦</div>
        </div>
      </div>
    </div>

    <div class="bottom">
      <div class="bottomHead">
        <div class="t">ë³´í˜¸êµ¬ ì„ íƒ (4ê°œ)</div>
        <div class="s">í•œ ë¬¸ì œë‹¹ 1ê°œë§Œ ì„ íƒ</div>
      </div>

      <div class="grid">
        <button class="opt" data-ppe="mask">
          <b>ë§ˆìŠ¤í¬</b>
          <small>ê¸°ë³¸(ë¹„ë§/ë¶„ë¬´)</small>
        </button>
        <button class="opt" data-ppe="n95">
          <b>N95 ë§ˆìŠ¤í¬</b>
          <small>ê³µê¸°(ê²°í•µ ë“±)</small>
        </button>
        <button class="opt" data-ppe="gown">
          <b>ê°€ìš´+ì¥ê°‘</b>
          <small>ì ‘ì´‰(ì˜¤ì—¼ë¬¼ ì²˜ë¦¬)</small>
        </button>
        <button class="opt" data-ppe="none">
          <b>PPE ë¶ˆí•„ìš”</b>
          <small>ìœ„í—˜ ë‚®ìŒ(êµìœ¡ìš©)</small>
        </button>
      </div>

      <div class="controls">
        <button id="restartBtn" class="mini">ì¬ì‹œì‘</button>
      </div>

      <div class="foot">â€» êµìœ¡ìš© ë‹¨ìˆœí™” ë²„ì „(í‘œì¤€ì£¼ì˜+ì¶”ê°€ì£¼ì˜ ê°œë… ê¸°ë°˜)</div>
    </div>
  </div>

  <script>
    /**********************
     * ì„¤ì •
     **********************/
    const TOTAL = 10;
    const FALL_SECONDS = 5.0;           // â€œ5ì´ˆ ë‚´ë ¤ì˜¤ê¸°â€
    const AFTER_SCORE_DELAY = 650;      // ì±„ì  í›„ ë‹¤ìŒë¬¸ì œë¡œ ë„˜ì–´ê°€ê¸° ë”œë ˆì´(ms)

    const ASSET = {
      idle: "assets/idle.png",
      good: "assets/correct.png",
      bad:  "assets/wrong.png",
    };

    // ë¬¸ì œ ë°ì´í„°(ì˜ˆì‹œ). í•„ìš”í•˜ë©´ ì—¬ê¸°ë§Œ ë°”ê¿”ì„œ ê³„ì† ëŠ˜ë¦¬ë©´ ë¨.
    // ppe: mask | n95 | gown | none
    const QUESTIONS = [
      { text:"ì¸í”Œë£¨ì—”ì í™˜ì êµ¬ì—­ ì²­ì†Œ", ppe:"mask" },
      { text:"ê²°í•µ ë³‘ì‹¤ ì²­ì†Œ", ppe:"n95" },
      { text:"VRE/CRE ì¥ê¸° ì¬ì‹¤ ë³‘ì‹¤ í‡´ì‹¤ í›„ ì²­ì†Œ", ppe:"gown" },
      { text:"ìˆ˜ë‘(êµìœ¡ìš© ë‹¨ìˆœí™”)", ppe:"n95" },
      { text:"í˜ˆì•¡/ì²´ì•¡ ì˜¤ì—¼ë¬¼ ì²˜ë¦¬", ppe:"gown" },
      { text:"ì¼ë°˜ ë³µë„ ì²­ì†Œ(ìœ„í—˜ ë‚®ìŒ)", ppe:"none" },
      { text:"í˜¸í¡ê¸° ì¦ìƒ í™˜ì ëŒ€ê¸°êµ¬ì—­ ì²­ì†Œ", ppe:"mask" },
      { text:"CDI í™˜ì êµ¬ì—­ ì²­ì†Œ(êµìœ¡ìš© ë‹¨ìˆœí™”)", ppe:"gown" },
      { text:"MRSA í™˜ì ì£¼ë³€ í™˜ê²½ ì²­ì†Œ(êµìœ¡ìš©)", ppe:"gown" },
      { text:"ì™¸ë˜ ëŒ€ê¸°êµ¬ì—­ ì •ë¦¬(ìœ„í—˜ ë‚®ìŒ)", ppe:"none" },
    ];

    /**********************
     * ìƒíƒœ
     **********************/
    let idx = 0;
    let score = 0;
    let running = false;
    let answered = false;

    let rafId = null;
    let startTime = 0;

    const elQ = document.getElementById("qStat");
    const elScore = document.getElementById("score");
    const elTime = document.getElementById("timeLeft");
    const elState = document.getElementById("state");
    const elLabel = document.getElementById("fallLabel");
    const dropArea = document.getElementById("dropArea");

    const overlay = document.getElementById("resultOverlay");
    const badge = document.getElementById("badge");
    const resultImg = document.getElementById("resultImg");
    const subhint = document.getElementById("subhint");
    const restartBtn = document.getElementById("restartBtn");

    function setState(txt){ elState.textContent = txt; }
    function setTime(t){ elTime.textContent = `${t.toFixed(1)}s`; }

    function updateHeader(){
      elQ.textContent = `${Math.min(idx+1, TOTAL)}/${TOTAL}`;
      elScore.textContent = `${score}`;
    }

    function stopAnim(){
      if(rafId) cancelAnimationFrame(rafId);
      rafId = null;
    }

    function showOverlay(isGood){
      overlay.style.display = "flex";
      badge.textContent = isGood ? "ì •ë‹µ âœ…" : "ì˜¤ë‹µ âŒ";
      badge.className = "badge " + (isGood ? "good" : "bad");
      resultImg.src = isGood ? ASSET.good : ASSET.bad;
      subhint.textContent = "ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤â€¦";
    }

    function hideOverlay(){
      overlay.style.display = "none";
      resultImg.src = ASSET.idle;
    }

    function layoutFallStart(){
      // ë¼ë²¨ì„ ë§¨ ìœ„(ì‚´ì§ ìœ„)ë¡œ
      elLabel.style.top = "-70px";
    }

    function animateFall(){
      const areaH = dropArea.clientHeight;
      const labelH = elLabel.getBoundingClientRect().height;

      const endY = Math.max(16, areaH - labelH - 14); // ë°”ë‹¥ì—ì„œ ì‚´ì§ ë„ìš°ê¸°
      const startY = -70;

      const now = performance.now();
      const elapsed = (now - startTime) / 1000;
      const remaining = Math.max(0, FALL_SECONDS - elapsed);
      setTime(remaining);

      const p = Math.min(1, elapsed / FALL_SECONDS);
      const y = startY + (endY - startY) * p;
      elLabel.style.top = `${y}px`;

      if(p >= 1 && running && !answered){
        // ì‹œê°„ ì´ˆê³¼ = ì˜¤ë‹µ ì²˜ë¦¬
        grade(null);
        return;
      }

      rafId = requestAnimationFrame(animateFall);
    }

    function startQuestion(){
      if(idx >= TOTAL){
        running = false;
        answered = true;
        setState("ì™„ë£Œ");
        setTime(0);
        elLabel.textContent = `ë! ì ìˆ˜ ${score}/${TOTAL}`;
        showOverlay(true);
        badge.textContent = "ì™„ë£Œ âœ…";
        badge.className = "badge good";
        subhint.textContent = "ì¬ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.";
        resultImg.src = ASSET.idle;
        return;
      }

      answered = false;
      running = true;
      hideOverlay();

      const q = QUESTIONS[idx % QUESTIONS.length];
      elLabel.textContent = q.text;

      layoutFallStart();
      updateHeader();
      setState("ì§„í–‰");
      setTime(FALL_SECONDS);

      startTime = performance.now();
      stopAnim();
      rafId = requestAnimationFrame(animateFall);
    }

    function nextQuestion(){
      idx++;
      startQuestion();
    }

    function grade(picked){
      if(answered) return;
      answered = true;
      running = false;
      stopAnim();

      const q = QUESTIONS[idx % QUESTIONS.length];
      const isGood = picked === q.ppe;

      if(isGood) score++;
      updateHeader();
      setState(isGood ? "ì •ë‹µ" : "ì˜¤ë‹µ");
      setTime(0);

      showOverlay(isGood);

      // ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ
      setTimeout(() => {
        hideOverlay();
        nextQuestion();
      }, AFTER_SCORE_DELAY);
    }

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.querySelectorAll("button.opt").forEach(btn=>{
      btn.addEventListener("click", (e)=>{
        e.preventDefault();
        const picked = btn.dataset.ppe;
        grade(picked);
      }, {passive:false});
    });

    // ì¬ì‹œì‘
    restartBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      resetAll();
    }, {passive:false});

    function resetAll(){
      stopAnim();
      idx = 0;
      score = 0;
      running = false;
      answered = false;
      hideOverlay();
      updateHeader();
      setState("ëŒ€ê¸°");
      setTime(FALL_SECONDS);
      elLabel.textContent = "ì‹œì‘ ì—†ì´ ìë™ ì§„í–‰";
      // ë°”ë¡œ 1ë²ˆ ë¬¸ì œ ì‹œì‘
      startQuestion();
    }

    // í™”ë©´ í¬ê¸° ë°”ë€Œë©´(ê°€ë¡œ/ì„¸ë¡œ ì „í™˜) ìœ„ì¹˜ ê¹¨ì§ ë°©ì§€
    window.addEventListener("resize", ()=>{
      if(!answered && running){
        // í˜„ì¬ ë¬¸ì œ ë‹¤ì‹œ ì‹œì‘(ì•ˆì „)
        startQuestion();
      }
    });

    // í˜ì´ì§€ ë¡œë“œí•˜ë©´ ìë™ ì‹œì‘(ì‹œì‘ ë²„íŠ¼ í•„ìš” ì—†ìŒ)
    resetAll();
  </script>
</body>
</html>
