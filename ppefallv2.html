<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í™˜ê²½ê´€ë¦¬ë‹´ë‹¹ì ë³´í˜¸êµ¬ êµìœ¡</title>

  <style>
    :root{
      --bg1:#071022;
      --bg2:#050a14;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.70);
      --shadow: 0 18px 40px rgba(0,0,0,.45);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% 0%, rgba(255,255,255,.08), transparent 60%),
                  radial-gradient(900px 700px at 100% 10%, rgba(255,255,255,.06), transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    /* ì „ì²´ ì•±: ìƒë‹¨+í”Œë ˆì´ì¡´+í•˜ë‹¨ë²„íŠ¼ */
    .app{
      min-height: 100dvh;
      padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* ====== ìƒë‹¨ ë°”(ì»´íŒ©íŠ¸) ====== */
    .topbar{
      display:grid;
      grid-template-columns: 1fr 110px;
      gap:12px;
      align-items:stretch;
    }

    .titleCard, .statCard{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 12px 14px;
      backdrop-filter: blur(10px);
    }

    .titleLine{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      letter-spacing:-.2px;
      font-size: 18px;
      line-height: 1.15;
      margin:0;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      font-size: 12px;
    }

    .statGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      height:100%;
    }
    .statRow{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
    }
    .statLabel{ color:var(--muted); font-size:12px; }
    .statValue{ font-weight:900; font-size:18px; letter-spacing:-.2px; }

    /* ì¬ì‹œì‘ ë²„íŠ¼(ì‘ê²Œ) */
    .restartBtn{
      margin-top:8px;
      width:100%;
      border:none;
      border-radius: 14px;
      padding: 10px 10px;
      background: rgba(255,255,255,.10);
      color:var(--text);
      font-weight:800;
      font-size: 13px;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      cursor:pointer;
    }
    .restartBtn:active{ transform: translateY(1px); }

    /* ====== í”Œë ˆì´ ì˜ì—­ ====== */
    .playZone{
      flex:1;
      background: rgba(255,255,255,.05);
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: var(--r);
      position:relative;
      overflow:hidden;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      min-height: 260px;
    }

    /* ë‚™í•˜í•˜ëŠ” "ì§ˆë³‘ëª… ì¹´ë“œ" */
    .falling{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      top: -120px;
      padding: 16px 18px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 18px 35px rgba(0,0,0,.35);
      font-weight: 900;
      font-size: 22px;
      letter-spacing: -.2px;
      text-align:center;
      white-space: nowrap;
      max-width: calc(100% - 24px);
      overflow:hidden;
      text-overflow: ellipsis;
      backdrop-filter: blur(10px);
    }

    /* ìƒë‹¨ì— ì•„ì£¼ ì–‡ì€ ì§„í–‰ì„  ëŠë‚Œ */
    .laneTop{
      position:absolute;
      left:16px;
      right:16px;
      top:10px;
      height:10px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .laneDots{
      position:absolute;
      inset:0;
      background-image: repeating-linear-gradient(90deg, rgba(255,255,255,.20) 0 10px, transparent 10px 18px);
      opacity:.25;
    }

    /* ì •ë‹µ/ì˜¤ë‹µ ì´ë¯¸ì§€ ì˜¤ë²„ë ˆì´ */
    .overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      opacity:0;
      transition: opacity .12s ease;
    }
    .overlay.show{ opacity:1; }
    .overlay img{
      width:min(220px, 65vw);
      height:auto;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.5));
    }

    /* ====== í•˜ë‹¨ ì„ íƒì§€(ê³ ì • ëŠë‚Œ) ====== */
    .choicesWrap{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 12px;
      backdrop-filter: blur(10px);
    }

    .choicesHead{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      margin-bottom: 10px;
    }
    .choicesTitle{
      font-weight: 900;
      font-size: 18px;
      letter-spacing: -.2px;
      margin:0;
    }
    .choicesHint{
      margin:0;
      color: var(--muted);
      font-size: 12px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .btn{
      appearance:none;
      border:none;
      border-radius: 18px;
      padding: 14px 10px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      cursor:pointer;
      min-height: 76px; /* ëª¨ë°”ì¼ í•œ í™”ë©´ì— ë“¤ì–´ì˜¤ê²Œ */
      text-align:center;
    }
    .btn:active{ transform: translateY(1px); }

    .btn .main{
      font-weight: 950;
      font-size: 22px;
      line-height: 1.05;
      letter-spacing: -.2px;
      display:block;
    }
    .btn .sub{
      margin-top: 6px;
      display:block;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.1;
      font-weight: 700;
    }

    .footNote{
      margin: 10px 0 0;
      text-align:center;
      color: rgba(234,240,255,.65);
      font-size: 12px;
    }

    /* ====== ëª¨ë°”ì¼ ë” ë¹¡ì„¸ê²Œ ì¤„ì´ê¸°(ì‘ì€ í™”ë©´) ====== */
    @media (max-width: 380px){
      .titleLine{ font-size:16px; }
      .falling{ font-size:20px; padding:14px 16px; }
      .btn{ min-height:70px; padding: 12px 8px; }
      .btn .main{ font-size:20px; }
      .btn .sub{ font-size:11px; }
      .choicesTitle{ font-size:17px; }
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- ìƒë‹¨ -->
    <div class="topbar">
      <div class="titleCard">
        <p class="titleLine">ğŸ§¹ í™˜ê²½ê´€ë¦¬ë‹´ë‹¹ì ë³´í˜¸êµ¬ êµìœ¡</p>
        <p class="subtitle">ì§ˆë³‘/ìƒí™©ì— ë§ëŠ” PPE 1ê°œë¥¼ ì„ íƒí•˜ì„¸ìš” (ì´ 5ë¬¸í•­)</p>
      </div>

      <div class="statCard">
        <div class="statGrid">
          <div class="statRow">
            <span class="statLabel">ë¬¸í•­</span>
            <span class="statValue" id="qStat">1/5</span>
          </div>
          <div class="statRow">
            <span class="statLabel">ì ìˆ˜</span>
            <span class="statValue" id="scoreStat">0</span>
          </div>
          <div class="statRow">
            <span class="statLabel">ì œí•œì‹œê°„</span>
            <span class="statValue" id="timeStat">5.0s</span>
          </div>
        </div>
        <button class="restartBtn" id="restartBtn">â†» ì¬ì‹œì‘</button>
      </div>
    </div>

    <!-- í”Œë ˆì´ ì˜ì—­ -->
    <div class="playZone" id="playZone" aria-label="ë¬¸ì œ ë‚™í•˜ ì˜ì—­">
      <div class="laneTop"><div class="laneDots"></div></div>

      <div class="falling" id="falling">ë¡œë”©â€¦</div>

      <div class="overlay" id="overlay">
        <img id="overlayImg" src="assets/idle.png" alt="ì •ë‹µ/ì˜¤ë‹µ í‘œì‹œ" />
      </div>
    </div>

    <!-- í•˜ë‹¨ ì„ íƒì§€ -->
    <div class="choicesWrap">
      <div class="choicesHead">
        <p class="choicesTitle">ë³´í˜¸êµ¬ ì„ íƒ (4ê°œ)</p>
        <p class="choicesHint">í•œ ë¬¸ì œë‹¹ 1ê°œë§Œ ì„ íƒ</p>
      </div>

      <div class="grid">
        <button class="btn" data-choice="MASK">
          <span class="main">ë§ˆìŠ¤í¬</span>
          <span class="sub">ê¸°ë³¸(ë¹„ë§/ë¶„ë¬´)</span>
        </button>

        <button class="btn" data-choice="N95">
          <span class="main">N95</span>
          <span class="sub">ê³µê¸°(ê²°í•µ ë“±)</span>
        </button>

        <button class="btn" data-choice="GOWN_GLOVES">
          <span class="main">ê°€ìš´+ì¥ê°‘</span>
          <span class="sub">ì ‘ì´‰(ì˜¤ì—¼ë¬¼ ì²˜ë¦¬)</span>
        </button>

        <button class="btn" data-choice="NONE">
          <span class="main">ë³´í˜¸êµ¬ ë¶ˆí•„ìš”</span>
          <span class="sub">ìœ„í—˜ ë‚®ìŒ(êµìœ¡ìš©)</span>
        </button>
      </div>

      <div class="footNote">ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    // ====== ì„¤ì • ======
    const QUESTIONS = [
      { text: "ì¼ë°˜ ë³µë„ ì²­ì†Œ", answer: "NONE" },
      { text: "í˜ˆì•¡/ì²´ì•¡ ì˜¤ì—¼ë¬¼ ì²˜ë¦¬(ìŠ¤í•„)", answer: "GOWN_GLOVES" },
      { text: "VRE/CRE ì¥ê¸° ì¬ì‹¤ ë³‘ì‹¤ í‡´ì‹¤ í›„ Terminal cleaning", answer: "GOWN_GLOVES" },
      { text: "ì¸í”Œë£¨ì—”ì í™˜ì êµ¬ì—­ ì²­ì†Œ", answer: "MASK" },
      { text: "ê²°í•µ ì˜ì‹¬/í™•ì§„ í™˜ì êµ¬ì—­ ì²­ì†Œ", answer: "N95" },
    ];

    const FALL_DURATION_SEC = 5.0;          // í•œ ë¬¸ì œë‹¹ ë‚™í•˜ ì œí•œì‹œê°„
    const FEEDBACK_MS = 550;                // ì •ë‹µ/ì˜¤ë‹µ ì´ë¯¸ì§€ ë…¸ì¶œ ì‹œê°„
    const IMG_CORRECT = "assets/correct.png";
    const IMG_WRONG   = "assets/wrong.png";
    const IMG_IDLE    = "assets/idle.png";

    // ====== ìƒíƒœ ======
    let qIndex = 0;
    let score = 0;

    let running = false;
    let answered = false;

    let startTime = 0;      // ms
    let rafId = null;

    // ====== DOM ======
    const playZone = document.getElementById("playZone");
    const falling = document.getElementById("falling");
    const overlay = document.getElementById("overlay");
    const overlayImg = document.getElementById("overlayImg");

    const qStat = document.getElementById("qStat");
    const scoreStat = document.getElementById("scoreStat");
    const timeStat = document.getElementById("timeStat");

    const restartBtn = document.getElementById("restartBtn");
    const buttons = Array.from(document.querySelectorAll(".btn"));

    // ====== ìœ í‹¸ ======
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function showOverlay(type){
      overlayImg.src = (type === "correct") ? IMG_CORRECT : (type === "wrong" ? IMG_WRONG : IMG_IDLE);
      overlay.classList.add("show");
      if(type === "idle"){
        overlay.classList.remove("show");
      }
    }

    function updateHUD(remainingSec){
      qStat.textContent = `${qIndex + 1}/${QUESTIONS.length}`;
      scoreStat.textContent = `${score}`;
      timeStat.textContent = `${remainingSec.toFixed(1)}s`;
    }

    function setFallingText(){
      falling.textContent = QUESTIONS[qIndex].text;
      // ê¸¸ë©´ ìë™ ì¤„ì„(ellipsis) - ì´ë¯¸ CSSë¡œ ì²˜ë¦¬ë¨
    }

    function resetFallingPosition(){
      falling.style.top = `-120px`;
    }

    function endQuestionTimedOut(){
      if(answered) return;
      answered = true;
      running = false;
      showOverlay("wrong");

      window.setTimeout(() => {
        overlay.classList.remove("show");
        nextQuestion();
      }, FEEDBACK_MS);
    }

    function nextQuestion(){
      qIndex += 1;

      if(qIndex >= QUESTIONS.length){
        // ì¢…ë£Œ í™”ë©´ì€ ê°„ë‹¨íˆ: ë§ˆì§€ë§‰ ê²°ê³¼ë¥¼ ë‚™í•˜ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
        falling.textContent = `ë! ì ìˆ˜: ${score}/${QUESTIONS.length}`;
        resetFallingPosition();
        falling.style.top = `42%`;
        falling.style.transform = "translate(-50%, -50%)";
        showOverlay("idle");
        updateHUD(0);
        return;
      }

      // ë‹¤ìŒ ë¬¸ì œ ì‹œì‘
      answered = false;
      running = true;
      falling.style.transform = "translateX(-50%)";
      setFallingText();
      resetFallingPosition();
      startTime = performance.now();
      loop();
    }

    function handleChoice(choice){
      if(!running || answered) return;

      answered = true;
      running = false;

      const correct = QUESTIONS[qIndex].answer;
      const isCorrect = (choice === correct);

      if(isCorrect) score += 1;

      showOverlay(isCorrect ? "correct" : "wrong");

      window.setTimeout(() => {
        overlay.classList.remove("show");
        nextQuestion();
      }, FEEDBACK_MS);
    }

    // ====== ë‚™í•˜ ì• ë‹ˆë©”ì´ì…˜ ======
    function loop(){
      cancelAnimationFrame(rafId);

      const now = performance.now();
      const elapsed = (now - startTime) / 1000;
      const t = clamp(elapsed / FALL_DURATION_SEC, 0, 1);

      // í”Œë ˆì´ì¡´ ë†’ì´ì— ë§ì¶° ì´ë™
      const zoneH = playZone.clientHeight;
      const startY = -120;
      const endY = zoneH - 130;  // í•˜ë‹¨ì— ë‹¿ê¸° ì§ì „
      const y = startY + (endY - startY) * t;
      falling.style.top = `${y}px`;

      const remaining = Math.max(0, FALL_DURATION_SEC - elapsed);
      updateHUD(remaining);

      if(!answered && t >= 1){
        endQuestionTimedOut();
        return;
      }

      if(running){
        rafId = requestAnimationFrame(loop);
      }
    }

    // ====== ì‹œì‘/ì¬ì‹œì‘ ======
    function startGame(){
      qIndex = 0;
      score = 0;
      answered = false;
      running = true;

      falling.style.transform = "translateX(-50%)";
      setFallingText();
      resetFallingPosition();

      overlay.classList.remove("show");
      overlayImg.src = IMG_IDLE;

      startTime = performance.now();
      loop();
    }

    restartBtn.addEventListener("click", () => {
      cancelAnimationFrame(rafId);
      startGame();
    });

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        handleChoice(btn.dataset.choice);
      });
    });

    // ë¡œë“œ ì‹œ ìë™ ì‹œì‘
    startGame();
  </script>
</body>
</html>
