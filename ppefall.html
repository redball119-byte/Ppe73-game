<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í™˜ê²½ê´€ë¦¬ PPE ë‚™í•˜ ê²Œì„</title>
  <style>
    :root{
      --bg:#071022;
      --card:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.75);
      --good:#22c55e;
      --bad:#ef4444;
      --btn:rgba(255,255,255,.10);
      --btnOn:rgba(34,197,94,.22);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:radial-gradient(1000px 600px at 50% -10%, rgba(255,255,255,.10), transparent 60%), var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Pretendard", "Noto Sans KR", Arial, sans-serif;
      overflow:hidden;
      height:100vh;
    }
    #hud{
      position:fixed; left:0; top:0; right:0;
      padding:14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      z-index:10;
    }
    .pill{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      padding:10px 12px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      font-weight:700;
      letter-spacing:-.2px;
      display:flex; align-items:center; gap:8px;
    }
    .sub{
      font-weight:600;
      color:var(--muted);
      font-size:13px;
    }
    #question{
      position:fixed;
      left:14px; right:14px;
      top:62px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:12px 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index:10;
    }
    #question .title{
      font-size:16px;
      font-weight:900;
      letter-spacing:-.3px;
      margin-bottom:6px;
    }
    #question .hint{
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
    }

    #game{
      position:relative;
      width:100vw;
      height:100vh;
    }

    /* ë–¨ì–´ì§€ëŠ” ì•„ì´í…œ(ê¸€ì”¨ ì¹´ë“œ) */
    .item{
      position:absolute;
      min-width:92px;
      padding:12px 12px;
      border-radius:16px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      text-align:center;
      font-weight:900;
      letter-spacing:-.3px;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      user-select:none;
      touch-action:none;
    }
    .item .small{
      display:block;
      margin-top:4px;
      font-size:12px;
      font-weight:700;
      color:rgba(234,240,255,.78);
    }

    /* ìºì²˜(í”Œë ˆì´ì–´) */
    #catcher{
      position:absolute;
      bottom:82px;
      left:50%;
      transform:translateX(-50%);
      width:84px;
      height:84px;
      border-radius:24px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:40px;
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      z-index:5;
    }

    /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
    #controls{
      position:fixed; left:0; right:0; bottom:0;
      padding:14px 14px calc(14px + env(safe-area-inset-bottom));
      display:flex;
      gap:10px;
      justify-content:center;
      z-index:10;
    }
    .btn{
      flex:1;
      max-width:240px;
      background:var(--btn);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      border-radius:16px;
      padding:14px 12px;
      font-weight:900;
      text-align:center;
      user-select:none;
    }
    .btn:active{ transform:scale(.98); }
    .btn.start{ background:rgba(34,197,94,.20); border-color:rgba(34,197,94,.35); }
    .btn.reset{ background:rgba(255,255,255,.08); }

    /* í”¼ë“œë°± í† ìŠ¤íŠ¸ */
    #toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:150px;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      opacity:0;
      transition:opacity .18s ease, transform .18s ease;
      z-index:20;
      pointer-events:none;
      white-space:nowrap;
    }
    #toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-6px);
    }
    .good{ color:var(--good); }
    .bad{ color:var(--bad); }

    /* ì‘ì€ í™”ë©´ ê¸€ì ì¡°ê¸ˆ í‚¤ìš°ê¸° */
    @media (max-width:360px){
      .item{ min-width:86px; padding:10px 10px; }
      #catcher{ width:76px; height:76px; }
    }
  </style>
</head>

<body>
  <div id="hud">
    <div class="pill">ğŸ§¹ í™˜ê²½ê´€ë¦¬ PPE ì„ íƒ</div>
    <div class="pill">
      <span>ì ìˆ˜:</span>
      <span id="score">0</span>
    </div>
  </div>

  <div id="question">
    <div class="title">ì˜¤ëŠ˜ì˜ ëª©í‘œ PPE: <span id="targetName">ì¥ê°‘</span></div>
    <div class="hint">ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” PPE ì¤‘ <b>ëª©í‘œ PPE</b>ë§Œ ë°›ì•„ì£¼ì„¸ìš”. (ê¸°ë³¸ ë³´í˜¸êµ¬ 4ì¢…)</div>
  </div>

  <div id="game">
    <div id="catcher" aria-label="catcher">ğŸ™‚</div>
  </div>

  <div id="toast"></div>

  <div id="controls">
    <div class="btn start" id="btnStart">ì‹œì‘</div>
    <div class="btn reset" id="btnReset">ë¦¬ì…‹</div>
  </div>

<script>
(() => {
  // âœ… í™˜ê²½ê´€ë¦¬ìš”ì› ê¸°ë³¸ PPE 4ì¢… (ê¸€ì”¨ë¡œë§Œ)
  const PPE = [
    { key:'glove',  name:'ì¥ê°‘',         sub:'ì²´ì•¡/ì˜¤ì—¼ ì ‘ì´‰' },
    { key:'gown',   name:'ê°€ìš´/ì•ì¹˜ë§ˆ',  sub:'ì˜¤ì—¼Â·íŠ€ê¹€ ì˜ˆë°©' },
    { key:'mask',   name:'ë§ˆìŠ¤í¬',       sub:'ë¹„ë§/ë¶„ë¬´' },
    { key:'goggle', name:'ê³ ê¸€/ì•ˆë©´ë³´í˜¸', sub:'ëˆˆÂ·ì–¼êµ´ íŠ' },
  ];

  const game = document.getElementById('game');
  const catcher = document.getElementById('catcher');
  const scoreEl = document.getElementById('score');
  const targetNameEl = document.getElementById('targetName');
  const toast = document.getElementById('toast');
  const btnStart = document.getElementById('btnStart');
  const btnReset = document.getElementById('btnReset');

  let running = false;
  let score = 0;

  // catcher ìœ„ì¹˜
  let catcherX = window.innerWidth / 2;
  const catcherW = () => catcher.getBoundingClientRect().width;
  const catcherH = () => catcher.getBoundingClientRect().height;

  // ëª©í‘œ PPE
  let target = PPE[0];

  // ë–¨ì–´ì§€ëŠ” ì•„ì´í…œ ê´€ë¦¬
  const items = new Set();
  let spawnTimer = 0;
  let lastTs = 0;

  function pickTarget(){
    target = PPE[Math.floor(Math.random() * PPE.length)];
    targetNameEl.textContent = target.name;
  }

  function setScore(v){
    score = v;
    scoreEl.textContent = score;
  }

  function showToast(text, ok){
    toast.textContent = text;
    toast.className = (ok ? 'good' : 'bad');
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(() => toast.classList.remove('show'), 650);
  }

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function placeCatcher(){
    const x = clamp(catcherX - catcherW()/2, 10, window.innerWidth - catcherW() - 10);
    catcher.style.left = (x + catcherW()/2) + 'px';
  }

  function spawnItem(){
    const p = PPE[Math.floor(Math.random() * PPE.length)];
    const el = document.createElement('div');
    el.className = 'item';
    el.dataset.key = p.key;
    el.innerHTML = `${p.name}<span class="small">${p.sub}</span>`;

    const w = 100 + Math.floor(Math.random()*60);
    el.style.minWidth = w + 'px';

    const x = 10 + Math.random() * (window.innerWidth - w - 20);
    el.style.left = x + 'px';
    el.style.top = (110) + 'px';

    // ì†ë„ (ëª¨ë°”ì¼ìš©: ë„ˆë¬´ ë¹ ë¥´ì§€ ì•Šê²Œ)
    const speed = 120 + Math.random() * 120; // px/s

    game.appendChild(el);
    items.add({ el, x, y:110, w, h:0, speed, key:p.key });
  }

  function rectsOverlap(a, b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }

  function step(ts){
    if(!running) return;
    const dt = Math.min(0.05, (ts - lastTs) / 1000 || 0);
    lastTs = ts;

    // ìŠ¤í°: ì´ˆë‹¹ 1~2ê°œ ì •ë„
    spawnTimer += dt;
    if(spawnTimer > 0.6){
      spawnTimer = 0;
      spawnItem();
      // ê°€ë” ëª©í‘œ ë°”ê¾¸ê¸° (í—·ê°ˆë¦¬ì§€ ì•Šê²Œ ìì£¼ ì•ˆ ë°”ê¿ˆ)
      if(Math.random() < 0.12) pickTarget();
    }

    // catcher ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    placeCatcher();
    const cRect = catcher.getBoundingClientRect();

    // ì•„ì´í…œ ì´ë™ + ì¶©ëŒ ì²´í¬
    for(const it of Array.from(items)){
      it.y += it.speed * dt;
      it.el.style.top = it.y + 'px';

      const r = it.el.getBoundingClientRect();
      const hit = rectsOverlap(r, cRect);

      // ë°”ë‹¥ ì§€ë‚˜ê°€ë©´ ì œê±°
      if(it.y > window.innerHeight + 120){
        it.el.remove();
        items.delete(it);
        continue;
      }

      if(hit){
        const correct = (it.key === target.key);
        if(correct){
          setScore(score + 1);
          showToast(`ì •ë‹µ +1 (${target.name})`, true);
        }else{
          // ìŒìˆ˜ë¡œ ë„ˆë¬´ ë‚´ë ¤ê°€ëŠ” ê±° ë°©ì§€
          setScore(Math.max(0, score - 1));
          showToast(`ì˜¤ë‹µ -1 (ëª©í‘œ: ${target.name})`, false);
        }
        it.el.remove();
        items.delete(it);
      }
    }

    requestAnimationFrame(step);
  }

  // ì¡°ì‘: ë“œë˜ê·¸ / í„°ì¹˜
  let dragging = false;

  function onMove(clientX){
    catcherX = clientX;
    placeCatcher();
  }

  catcher.addEventListener('pointerdown', (e)=>{
    dragging = true;
    catcher.setPointerCapture(e.pointerId);
  });
  window.addEventListener('pointermove', (e)=>{
    if(!dragging) return;
    onMove(e.clientX);
  });
  window.addEventListener('pointerup', ()=>{
    dragging = false;
  });

  // í™”ë©´ ì•„ë¬´ ê³³ ë“œë˜ê·¸í•´ë„ ì´ë™ë˜ê²Œ (í¸í•¨)
  game.addEventListener('pointerdown', (e)=>{ dragging = true; onMove(e.clientX); });
  game.addEventListener('pointermove', (e)=>{ if(dragging) onMove(e.clientX); });
  game.addEventListener('pointerup', ()=>{ dragging = false; });

  // ë²„íŠ¼
  btnStart.addEventListener('click', ()=>{
    if(running) return;
    setScore(0);
    pickTarget();
    running = true;
    lastTs = 0;
    showToast('ì‹œì‘!', true);
    requestAnimationFrame(step);
  });

  btnReset.addEventListener('click', ()=>{
    running = false;
    setScore(0);
    pickTarget();
    for(const it of Array.from(items)){
      it.el.remove();
      items.delete(it);
    }
    showToast('ë¦¬ì…‹ ì™„ë£Œ', true);
  });

  // ì´ˆê¸° ìœ„ì¹˜
  pickTarget();
  placeCatcher();

  window.addEventListener('resize', placeCatcher);
})();
</script>
</body>
</html>
