<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë‚™í•˜í˜• PPE ì„ íƒ ê²Œì„</title>
  <style>
    :root{
      --bg:#071022;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.14);
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.72);
      --good:#22c55e;
      --bad:#ef4444;
      --accent:#60a5fa;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background: radial-gradient(1200px 700px at 20% 0%, #132045 0%, var(--bg) 55%);
      color:var(--text); font-family: system-ui, -apple-system, "Pretendard", "Apple SD Gothic Neo", sans-serif;
      min-height:100vh;
    }
    .wrap{
      max-width: 520px; margin: 0 auto; padding: 14px 12px 18px;
    }
    .hud{
      display:flex; gap:10px; justify-content:space-between; align-items:center;
      margin-bottom:10px;
    }
    .pill{
      background: var(--card); border:1px solid var(--stroke); border-radius:999px;
      padding:10px 12px; font-weight:800; letter-spacing:.2px;
      display:flex; gap:8px; align-items:center; min-width: 150px; justify-content:center;
    }
    .pill small{font-weight:700; color:var(--muted)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border:1px solid var(--stroke); border-radius:22px;
      padding: 12px; overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
    }
    canvas{
      width:100%; height:auto; display:block;
      border-radius:18px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
    }
    .tips{
      margin:10px 4px 12px; color:var(--muted); font-size:13px; line-height:1.35;
    }
    .panel{
      margin-top: 10px;
      background: var(--card2);
      border:1px solid var(--stroke);
      border-radius: 22px;
      padding: 12px;
    }
    .panel h3{
      margin: 0 0 10px; font-size:15px; letter-spacing:.2px;
      display:flex; align-items:center; gap:8px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
    }
    button{
      appearance:none; border:1px solid var(--stroke); background: rgba(255,255,255,.07);
      color: var(--text); border-radius: 16px;
      padding: 14px 12px;
      font-size: 16px; font-weight: 900;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      touch-action: manipulation;
    }
    button .sub{font-size:12px; color:var(--muted); font-weight:800}
    button.sel{ outline:2px solid rgba(96,165,250,.55); border-color: rgba(96,165,250,.65); background: rgba(96,165,250,.18); }
    .row{
      display:flex; gap:10px; margin-top:10px;
    }
    .row button{
      flex:1;
      justify-content:center;
      border-radius: 18px;
    }
    .primary{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.55); }
    .danger{ background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.55); }
    .ghost{ background: rgba(255,255,255,.06); }

    /* ê²°ê³¼ ì˜¤ë²„ë ˆì´ */
    .overlay{
      position:fixed; inset:0; display:none; place-items:center;
      background: rgba(0,0,0,.55);
      padding: 20px;
      z-index: 50;
    }
    .overlay .box{
      width:min(420px, 92vw);
      background: rgba(10,16,35,.92);
      border:1px solid rgba(255,255,255,.16);
      border-radius: 22px;
      padding: 14px;
      text-align:center;
      box-shadow: 0 20px 80px rgba(0,0,0,.5);
    }
    .overlay img{ width: min(240px, 60vw); height:auto; display:block; margin: 6px auto 10px; }
    .overlay .msg{ font-weight: 900; font-size: 18px; margin: 6px 0 8px; }
    .overlay .exp{ color: var(--muted); font-size: 14px; line-height: 1.35; margin: 0 0 10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="pill">ìŠ¤í…Œì´ì§€: <span id="stage">1</span><small>/10</small></div>
      <div class="pill">ì ìˆ˜: <span id="score">0</span></div>
    </div>

    <div class="card">
      <canvas id="game" width="480" height="520"></canvas>
      <div class="tips">
        âœ… ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” <b>ìƒí™©(ì§ˆí™˜/ì˜¤ì—¼)</b>ì„ ë³´ê³  ì•„ë˜ PPEë¥¼ ì„ íƒí•˜ì„¸ìš”. <br/>
        â±ï¸ ë°”ë‹¥ì— ë‹¿ê¸° ì „ì— ì„ íƒí•˜ë©´ ìœ ë¦¬í•´ìš”!
      </div>
    </div>

    <div class="panel">
      <h3>ğŸ§¤ PPE ì„ íƒ (ì—¬ëŸ¬ ê°œ ê°€ëŠ¥)</h3>
      <div class="grid" id="ppeGrid"></div>
      <div class="row">
        <button class="ghost" id="clearBtn">ì„ íƒ ì´ˆê¸°í™”</button>
        <button class="primary" id="submitBtn">ì œì¶œ</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="box">
      <img id="ovImg" alt="result" />
      <div class="msg" id="ovMsg"></div>
      <p class="exp" id="ovExp"></p>
      <button class="ghost" id="nextBtn">ë‹¤ìŒ</button>
    </div>
  </div>

<script>
/** ==========================
 *  1) ë¬¸ì œ(10ë¬¸í•­) â€” í™˜ê²½ê´€ë¦¬ìš”ì›ìš©, ì§§ê²Œ
 *  ========================== */
const QUESTIONS = [
  { title:"ê²°í•µ", desc:"ê²°í•µ ì˜ì‹¬/í™•ì§„ ë³‘ì‹¤ ì²­ì†Œ", need:["N95"] , explain:"ê²°í•µì€ ê³µê¸°ì „íŒŒ ìœ„í—˜ â†’ N95(ë˜ëŠ” ë™ê¸‰) ê¶Œì¥. ì²­ì†Œ ì‹œ ë¹„ë§/ë¶„ì§„ ë°œìƒ ì£¼ì˜."},
  { title:"ìˆ˜ë‘", desc:"ìˆ˜ë‘ í™˜ì í‡´ì‹¤ í›„ ì²­ì†Œ", need:["N95","ì¥ê°‘","ê°€ìš´"] , explain:"ìˆ˜ë‘ëŠ” ê³µê¸°+ì ‘ì´‰ ì£¼ì˜ê°€ í”íˆ ë³‘í–‰ â†’ N95 + ì¥ê°‘/ê°€ìš´(ì˜¤ì—¼ ê°€ëŠ¥ ì‹œ)."},
  { title:"ë…ê°", desc:"ë…ê° í™˜ì ë³‘ì‹¤ ì²­ì†Œ", need:["ìˆ˜ìˆ ë§ˆìŠ¤í¬","ì¥ê°‘"] , explain:"ë…ê°ì€ ë¹„ë§ ìœ„í—˜ â†’ ë§ˆìŠ¤í¬ + ì ‘ì´‰(ì˜¤ì—¼ ê°€ëŠ¥) ëŒ€ë¹„ ì¥ê°‘."},
  { title:"CRE", desc:"CRE ê²©ë¦¬ì‹¤ ì²­ì†Œ", need:["ì¥ê°‘","ê°€ìš´"] , explain:"CREëŠ” ì ‘ì´‰ì „íŒŒ ì¤‘ì‹¬ â†’ ì¥ê°‘/ê°€ìš´(ì ‘ì´‰ì˜¤ì—¼ ëŒ€ë¹„)."},
  { title:"ì„¤ì‚¬", desc:"ì„¤ì‚¬ë¡œ ë³€ ì˜¤ì—¼(ë°”ë‹¥/ë³€ê¸°)", need:["ì¥ê°‘","ê°€ìš´","ê³ ê¸€"] , explain:"ë¶„ë³€ ì˜¤ì—¼ì€ íŠ/ì ‘ì´‰ ìœ„í—˜ í¼ â†’ ì¥ê°‘/ê°€ìš´ + íŠ ê°€ëŠ¥ ì‹œ ê³ ê¸€."},
  { title:"í˜ˆì•¡", desc:"í˜ˆì•¡ì´ ë°”ë‹¥ì— íŠ", need:["ì¥ê°‘","ê°€ìš´","ê³ ê¸€"] , explain:"í˜ˆì•¡ íŠ ê°€ëŠ¥ â†’ ì¥ê°‘/ê°€ìš´ + ëˆˆ ë³´í˜¸(ê³ ê¸€)."},
  { title:"êµ¬í† ", desc:"êµ¬í† ë¬¼ ì˜¤ì—¼ ì²­ì†Œ", need:["ìˆ˜ìˆ ë§ˆìŠ¤í¬","ì¥ê°‘","ê³ ê¸€"] , explain:"êµ¬í† ë¬¼ì€ íŠ/ë¹„ë§ ê°€ëŠ¥ â†’ ë§ˆìŠ¤í¬ + ì¥ê°‘ + ê³ ê¸€."},
  { title:"ê²©ë¦¬íê¸°ë¬¼", desc:"ê²©ë¦¬ì˜ë£Œíê¸°ë¬¼ ë´‰íˆ¬/ìš©ê¸° ì²˜ë¦¬", need:["ì¥ê°‘"] , explain:"ë´‰íˆ¬/ìš©ê¸° ì ‘ì´‰ ìœ„í—˜ â†’ ì¥ê°‘ ê¸°ë³¸."},
  { title:"ì˜¤ì—¼ë¦°ë„¨", desc:"ì˜¤ì—¼ ë¦°ë„¨ ìˆ˜ê±°/ì´ì†¡", need:["ì¥ê°‘","ê°€ìš´"] , explain:"ë¦°ë„¨ ì ‘ì´‰ì˜¤ì—¼ ê°€ëŠ¥ â†’ ì¥ê°‘ + ê°€ìš´(ì˜¤ì—¼ ì˜ˆìƒ ì‹œ)."},
  { title:"í™”ì¥ì‹¤", desc:"í™˜ì í™”ì¥ì‹¤ ì²­ì†Œ", need:["ì¥ê°‘","ê°€ìš´"] , explain:"í™˜ê²½ í‘œë©´ ì ‘ì´‰ ë§ìŒ â†’ ì¥ê°‘ + ê°€ìš´(ì˜¤ì—¼ ê°€ëŠ¥ ì‹œ)."}
];

/** ==========================
 *  2) PPE ë²„íŠ¼ ëª©ë¡
 *  ========================== */
const PPE = [
  { key:"ìˆ˜ìˆ ë§ˆìŠ¤í¬", label:"ìˆ˜ìˆ ë§ˆìŠ¤í¬", sub:"ë¹„ë§" },
  { key:"N95", label:"N95 ë§ˆìŠ¤í¬", sub:"ê³µê¸°" },
  { key:"ì¥ê°‘", label:"ì¥ê°‘", sub:"ì ‘ì´‰" },
  { key:"ê°€ìš´", label:"ê°€ìš´", sub:"ì˜¤ì—¼/ì ‘ì´‰" },
  { key:"ê³ ê¸€", label:"ê³ ê¸€", sub:"ëˆˆ ë³´í˜¸" },
];

/** ==========================
 *  3) ì´ë¯¸ì§€(assets í´ë”)
 *  - ë„ˆê°€ ì˜¬ë¦° íŒŒì¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 *  ========================== */
const IMG_IDLE = "assets/idle.png";
const IMG_OK   = "assets/correct.png";
const IMG_BAD  = "assets/wrong.png";

/** ==========================
 *  4) UI ë Œë”
 *  ========================== */
const ppeGrid = document.getElementById("ppeGrid");
const selected = new Set();

PPE.forEach(item=>{
  const btn=document.createElement("button");
  btn.innerHTML = `<span>${item.label}</span><span class="sub">${item.sub}</span>`;
  btn.addEventListener("click", ()=>{
    if(selected.has(item.key)) selected.delete(item.key);
    else selected.add(item.key);
    btn.classList.toggle("sel");
  });
  btn.dataset.key=item.key;
  ppeGrid.appendChild(btn);
});

function clearSelection(){
  selected.clear();
  [...ppeGrid.querySelectorAll("button")].forEach(b=>b.classList.remove("sel"));
}
document.getElementById("clearBtn").addEventListener("click", clearSelection);

/** ==========================
 *  5) ìº”ë²„ìŠ¤ â€œë‚™í•˜â€ ê²Œì„
 *  ========================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const stageEl = document.getElementById("stage");
const scoreEl = document.getElementById("score");

let stage = 0;
let score = 0;

const idleImg = new Image(); idleImg.src = IMG_IDLE;

let item = null;     // ë–¨ì–´ì§€ëŠ” ë¬¸ì œ ê°ì²´
let lastT = 0;
let running = true;

function nextStage(){
  clearSelection();
  if(stage >= QUESTIONS.length){
    showOverlay(true, "ë! ğŸ‰", `ìµœì¢… ì ìˆ˜: ${score} / ${QUESTIONS.length}\në‹¤ì‹œ í•˜ë ¤ë©´ ìƒˆë¡œê³ ì¹¨!`, true);
    running=false;
    return;
  }
  stageEl.textContent = (stage+1);
  item = makeFallingItem(QUESTIONS[stage]);
  stage++;
}

function makeFallingItem(q){
  return {
    q,
    x: canvas.width/2,
    y: 70,
    vy: 55,             // ê¸°ë³¸ ë‚™í•˜ ì†ë„(px/s)
    radius: 86,
    startAt: performance.now(),
  };
}

function drawRoundedRect(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

function draw(){
  // ë°°ê²½
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ìƒë‹¨ ì•ˆë‚´
  ctx.fillStyle = "rgba(255,255,255,.10)";
  drawRoundedRect(18, 16, canvas.width-36, 86, 18);
  ctx.fill();

  ctx.fillStyle = "rgba(234,240,255,.92)";
  ctx.font = "900 22px system-ui";
  ctx.fillText("ìƒí™©", 34, 48);

  ctx.fillStyle = "rgba(234,240,255,.70)";
  ctx.font = "700 14px system-ui";
  ctx.fillText("ì•„ë˜ì—ì„œ PPEë¥¼ ì„ íƒí•˜ì„¸ìš”", 34, 74);

  // ìºë¦­í„°(ì‘ê²Œ)
  if(idleImg.complete){
    ctx.globalAlpha = 0.95;
    ctx.drawImage(idleImg, canvas.width-110, 18, 88, 88);
    ctx.globalAlpha = 1;
  }

  if(!item) return;

  // ë–¨ì–´ì§€ëŠ” ì¹´ë“œ
  const q = item.q;
  const w = 360;
  const h = 140;
  const x = Math.max(18, Math.min(canvas.width-18-w, item.x - w/2));
  const y = item.y;

  ctx.fillStyle = "rgba(255,255,255,.10)";
  drawRoundedRect(x, y, w, h, 20);
  ctx.fill();
  ctx.strokeStyle = "rgba(255,255,255,.18)";
  ctx.lineWidth = 1;
  ctx.stroke();

  // ì œëª©
  ctx.fillStyle = "rgba(234,240,255,.96)";
  ctx.font = "900 34px system-ui";
  ctx.fillText(q.title, x+22, y+58);

  // ì„¤ëª…
  ctx.fillStyle = "rgba(234,240,255,.75)";
  ctx.font = "800 16px system-ui";
  wrapText(q.desc, x+22, y+90, w-44, 20);

  // ë°”ë‹¥ ë¼ì¸
  ctx.strokeStyle="rgba(255,255,255,.10)";
  ctx.beginPath();
  ctx.moveTo(18, canvas.height-18);
  ctx.lineTo(canvas.width-18, canvas.height-18);
  ctx.stroke();
}

function wrapText(text, x, y, maxW, lh){
  const words = text.split(" ");
  let line = "";
  for(let n=0;n<words.length;n++){
    const test = line + words[n] + " ";
    const m = ctx.measureText(test);
    if(m.width > maxW && n>0){
      ctx.fillText(line, x, y);
      line = words[n] + " ";
      y += lh;
    }else{
      line = test;
    }
  }
  ctx.fillText(line, x, y);
}

function step(t){
  if(!running){ return; }
  if(!lastT) lastT = t;
  const dt = (t-lastT)/1000;
  lastT = t;

  if(item){
    // ìŠ¤í…Œì´ì§€ê°€ ë’¤ë¡œ ê°ˆìˆ˜ë¡ ì¡°ê¸ˆ ë¹¨ë¼ì§
    const speedUp = 1 + (stage-1)*0.10;
    item.y += item.vy * speedUp * dt;

    // ë°”ë‹¥ ë‹¿ìœ¼ë©´ ìë™ ì±„ì 
    if(item.y + 140 >= canvas.height-18){
      judge();
    }
  }

  draw();
  requestAnimationFrame(step);
}

/** ==========================
 *  6) ì±„ì  / ê²°ê³¼
 *  ========================== */
const overlay = document.getElementById("overlay");
const ovImg = document.getElementById("ovImg");
const ovMsg = document.getElementById("ovMsg");
const ovExp = document.getElementById("ovExp");
const nextBtn = document.getElementById("nextBtn");

function showOverlay(isCorrect, title, exp, isEnd=false){
  overlay.style.display="grid";
  ovImg.src = isCorrect ? IMG_OK : IMG_BAD;
  ovMsg.textContent = title;
  ovExp.textContent = exp;
  nextBtn.textContent = isEnd ? "ë‹«ê¸°" : "ë‹¤ìŒ";
}

function hideOverlay(){
  overlay.style.display="none";
}

function setEq(a,b){
  if(a.size !== b.size) return false;
  for(const v of a) if(!b.has(v)) return false;
  return true;
}

function judge(){
  if(!item) return;
  const needSet = new Set(item.q.need);

  // ì´ë²ˆ ë¬¸ì œëŠ” "ì •í™•íˆ ì¼ì¹˜"ë¡œ ì±„ì (ì‚¼ì„± ìŠ¤íƒ€ì¼ ëŠë‚Œ)
  const ok = setEq(selected, needSet);

  if(ok){
    score += 1;
    scoreEl.textContent = score;
    showOverlay(true, "ì •ë‹µ! +1", item.q.explain);
  }else{
    const needText = [...needSet].join(", ");
    const selText = selected.size ? [...selected].join(", ") : "ì„ íƒ ì—†ìŒ";
    showOverlay(false, "ì˜¤ë‹µ", `ì •ë‹µ: ${needText}\nì„ íƒ: ${selText}\n\n${item.q.explain}`);
  }

  item = null;
}

document.getElementById("submitBtn").addEventListener("click", ()=>{
  // ì œì¶œ ë²„íŠ¼ìœ¼ë¡œë„ ì±„ì 
  judge();
});

nextBtn.addEventListener("click", ()=>{
  hideOverlay();
  nextStage();
});

// ì‹œì‘
nextStage();
requestAnimationFrame(step);
</script>
</body>
</html>
