<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PPE ì„ íƒ ê²Œì„</title>
  <style>
    :root{
      --bg1:#0b1020; --bg2:#101a33;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.10);
      --text:#eaf0ff; --muted: rgba(234,240,255,.75);
      --good:#22c55e; --bad:#ef4444; --pri:#7c3aed;
      --stroke: rgba(255,255,255,.14);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--text);
      font-family: system-ui,-apple-system,"Noto Sans KR",sans-serif;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(124,58,237,.35), transparent 60%),
        radial-gradient(900px 500px at 80% 15%, rgba(34,197,94,.25), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    .wrap{width:min(820px, 100%);}

    .topbar{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin-bottom:12px;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px; border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      font-weight:700;
    }
    .pill small{font-weight:600; color:var(--muted)}
    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 860px){
      .grid{grid-template-columns: 1.2fr .8fr;}
    }

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:16px;
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .title{
      font-size:26px; font-weight:900; letter-spacing:-.5px;
      margin:0 0 4px;
    }
    .desc{margin:0; color:var(--muted); font-weight:650}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      margin-top:10px;
    }
    .badge{
      padding:7px 10px; border-radius:999px;
      background:rgba(255,255,255,.10);
      border:1px solid var(--stroke);
      font-weight:800; font-size:13px;
    }

    /* ìºë¦­í„° í”„ë ˆì„ */
    .charFrame{
      margin-top:14px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:14px;
      display:flex; align-items:center; justify-content:center;
      min-height:260px;
    }
    .char{
      width:min(360px, 100%);
      aspect-ratio: 1 / 1;
      border-radius:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.12);
      position:relative;
      overflow:hidden;
    }
    /* í•œ ì¥ ì´ë¯¸ì§€ë¥¼ 4ë“±ë¶„(ê°€ë¡œ 4ì¹¸)í•´ì„œ ìƒíƒœë³„ë¡œ ë³´ì—¬ì¤Œ */
    .char::before{
      content:"";
      position:absolute; inset:0;
      background-image:url("char.png"); /* <-- ì—¬ê¸° íŒŒì¼ëª…ë§Œ ë§ì¶°ì¤˜ */
      background-repeat:no-repeat;
      background-size: 400% 100%;
      background-position: 0% 0%;
      image-rendering: auto;
      transform: scale(0.98);
      transform-origin:center;
    }
    /* ìƒíƒœë³„ ìœ„ì¹˜: idle(0), correct(1), wrong(2), win(3) */
    .char[data-state="idle"]::before{ background-position: 0% 0%; }
    .char[data-state="correct"]::before{ background-position: 33.333% 0%; }
    .char[data-state="wrong"]::before{ background-position: 66.666% 0%; }
    .char[data-state="win"]::before{ background-position: 100% 0%; }

    /* ë²„íŠ¼ ì˜ì—­ */
    .choices{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.07);
      color:var(--text);
      border-radius:16px;
      padding:14px 12px;
      font-weight:900;
      cursor:pointer;
      text-align:center;
      user-select:none;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      min-height:64px;
      display:flex; flex-direction:column; justify-content:center; gap:4px;
    }
    .btn:hover{ background:rgba(255,255,255,.10); }
    .btn:active{ transform: scale(.985); }
    .btn small{color:var(--muted); font-weight:800}
    .btn.pri{ background:linear-gradient(180deg, rgba(124,58,237,.95), rgba(124,58,237,.70)); border-color: rgba(124,58,237,.55);}
    .btn.ghost{ background:rgba(255,255,255,.05); }

    .footer{
      margin-top:14px;
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:space-between; align-items:center;
    }
    .msg{
      min-height:26px;
      font-weight:900;
      display:flex; align-items:center; gap:8px;
    }
    .msg.ok{ color: #baf7c9; }
    .msg.bad{ color: #ffd1d1; }
    .hint{ color:var(--muted); font-weight:750; font-size:13px; }

    /* ì‹œì‘ í™”ë©´ */
    .overlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      padding:18px;
    }
    .modal{
      width:min(520px, 100%);
      border-radius:22px;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.18);
      padding:18px;
      box-shadow: 0 20px 70px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      text-align:center;
    }
    .modal h1{
      margin:6px 0 4px; font-size:34px; font-weight:1000; letter-spacing:-1px;
    }
    .modal p{ margin:0 0 12px; color:var(--muted); font-weight:750; }
    .row{ display:flex; gap:10px; margin-top:12px; }
    input{
      flex:1;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.20);
      color:var(--text);
      font-weight:800;
      outline:none;
    }
    input::placeholder{ color:rgba(234,240,255,.55); }
    .modal .btn{ width:100%; }
    .tiny{ margin-top:10px; font-size:12px; color:rgba(234,240,255,.6); font-weight:700; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="pill"><span id="stageTxt">ë¬¸í•­ 1 / 10</span> <small>Â·</small> <small>í˜„ì¬ ì ìˆ˜</small> <span id="scoreTxt">0</span></div>
      <div class="pill"><small>ìµœê³ ì ìˆ˜</small> <span id="bestTxt">0</span></div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="title" id="qTitle">PPE ì„ íƒ ê²Œì„</div>
        <p class="desc" id="qDesc">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì½ê³ , ì˜¬ë°”ë¥¸ PPE ë˜ëŠ” ê²©ë¦¬ìœ í˜•ì„ ê³ ë¥´ì„¸ìš”.</p>

        <div class="tag" id="tagWrap">
          <span class="badge" id="qTypeBadge">í˜¼í•©</span>
          <span class="badge" id="qKeyBadge">PPE/ê²©ë¦¬</span>
        </div>

        <div class="charFrame">
          <div class="char" id="char" data-state="idle" aria-label="ìºë¦­í„°"></div>
        </div>

        <div class="choices" id="choices"></div>

        <div class="footer">
          <div class="msg" id="msg"></div>
          <div style="display:flex; gap:10px;">
            <button class="btn ghost" id="btnReset" type="button">ì²˜ìŒìœ¼ë¡œ</button>
            <button class="btn pri" id="btnNext" type="button">ë‹¤ìŒ</button>
          </div>
        </div>

        <div class="hint" id="hint">
          íŒ: ì´ ê²Œì„ì€ â€œPPE ì„ íƒ + ê²©ë¦¬ìœ í˜•â€ì´ ì„ì—¬ ë‚˜ì˜µë‹ˆë‹¤. (ì‚¼ì„±ë³‘ì› ìŠ¤íƒ€ì¼)
        </div>
      </div>

      <div class="card">
        <div class="title" style="font-size:18px; margin:0 0 8px;">ë‚´ ê¸°ë¡</div>
        <p class="desc" id="userTxt" style="margin-bottom:10px;">ì´ë¦„: -</p>

        <div class="badge" style="display:block; text-align:left;">
          âœ… ì •ë‹µ: <span id="okCnt">0</span><br/>
          âŒ ì˜¤ë‹µ: <span id="badCnt">0</span><br/>
          ğŸ” ì—°ì†ì •ë‹µ: <span id="streakCnt">0</span>
        </div>

        <div style="height:12px"></div>

        <div class="badge" style="display:block; text-align:left;">
          ì €ì¥: ì´ ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤ (localStorage).
        </div>

        <div class="tiny">
          (ì›í•˜ë©´ ë‚˜ì¤‘ì— Firebaseë¡œ â€œëˆ„ê°€/ì–¸ì œ/ëª‡ì â€ ì €ì¥ë„ ê°€ëŠ¥)
        </div>
      </div>
    </div>
  </div>

  <!-- ì‹œì‘ ëª¨ë‹¬ -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="badge" style="display:inline-block;">êµìœ¡ìš© PPE & ê²©ë¦¬ìœ í˜• í€´ì¦ˆ</div>
      <h1>START GAME</h1>
      <p>ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë³´ê³  â€œPPEâ€ ë˜ëŠ” â€œê²©ë¦¬ìœ í˜•â€ì„ ì„ íƒí•˜ì„¸ìš”.</p>
      <div class="row">
        <input id="nameInput" placeholder="ì´ë¦„(ì„ íƒ)" maxlength="20" />
      </div>
      <div style="height:10px;"></div>
      <button class="btn pri" id="btnStart" type="button">ê²Œì„ ì‹œì‘</button>
      <div class="tiny">ìºë¦­í„° ì´ë¯¸ì§€ íŒŒì¼ëª…ì€ <b>char.png</b> (index.htmlê³¼ ê°™ì€ í´ë”)</div>
    </div>
  </div>

  <script>
    // ====== ë¬¸ì œì€í–‰ (PPE + ê²©ë¦¬ìœ í˜• í˜¼í•©) ======
    // type: "PPE" ë˜ëŠ” "ISO"
    const QUESTIONS = [
      {
        type:"ISO",
        title:"íê²°í•µ ì˜ì‹¬ í™˜ì ë³‘ì‹¤ ì…ì‹¤",
        desc:"ê¸°ì¹¨/ê°ë‹´, ê³µê¸° ì „íŒŒ ì˜ì‹¬. ìš°ì„  ì–´ë–¤ ê²©ë¦¬ì£¼ì˜?",
        key:"ê³µê¸°ì£¼ì˜",
        options:["í‘œì¤€ì£¼ì˜","ì ‘ì´‰ì£¼ì˜","ë¹„ë§ì£¼ì˜","ê³µê¸°ì£¼ì˜"],
        answer:"ê³µê¸°ì£¼ì˜",
        explain:"í™œë™ì„± íê²°í•µ ì˜ì‹¬/í™•ì§„ì€ ê³µê¸°ì£¼ì˜(ìŒì•• ê²©ë¦¬ ê³ ë ¤)ì…ë‹ˆë‹¤."
      },
      {
        type:"PPE",
        title:"íê²°í•µ ì˜ì‹¬ í™˜ì ë³‘ì‹¤ ì…ì‹¤",
        desc:"ê³µê¸°ì£¼ì˜ ì˜ì‹¬ ìƒí™©. ê¸°ë³¸ í˜¸í¡ê¸° ë³´í˜¸êµ¬ëŠ”?",
        key:"N95",
        options:["ìˆ˜ìˆ ë§ˆìŠ¤í¬","N95","ì¥ê°‘","ê°€ìš´"],
        answer:"N95",
        explain:"ê³µê¸°ì£¼ì˜(ê²°í•µ/í™ì—­/ìˆ˜ë‘ ë“±) ì˜ì‹¬ ì‹œ N95(ë˜ëŠ” ë™ê¸‰) ì°©ìš©ì´ ì›ì¹™ì…ë‹ˆë‹¤."
      },
      {
        type:"ISO",
        title:"ì¸í”Œë£¨ì—”ì ì˜ì‹¬ í™˜ì ì§„ë£Œ",
        desc:"ê¸°ì¹¨/ë°œì—´. í˜¸í¡ê¸° ì¦ìƒ. ì–´ë–¤ ê²©ë¦¬ì£¼ì˜?",
        key:"ë¹„ë§ì£¼ì˜",
        options:["í‘œì¤€ì£¼ì˜","ë¹„ë§ì£¼ì˜","ê³µê¸°ì£¼ì˜","ì ‘ì´‰ì£¼ì˜"],
        answer:"ë¹„ë§ì£¼ì˜",
        explain:"ì¸í”Œë£¨ì—”ì ë“±ì€ ë¹„ë§ì£¼ì˜ê°€ ê¸°ë³¸ì´ë©° ìƒí™©ì— ë”°ë¼ ì¶”ê°€ ì¡°ì¹˜í•©ë‹ˆë‹¤."
      },
      {
        type:"PPE",
        title:"í˜ˆì•¡ì´ íŠˆ ìœ„í—˜ì´ ìˆëŠ” ì²˜ì¹˜",
        desc:"ì²´ì•¡/í˜ˆì•¡ ë¹„ì‚°(íŠ€ê¹€) ìœ„í—˜. ì¶”ê°€ë¡œ í•„ìš”í•œ PPEëŠ”?",
        key:"ë³´ì•ˆê²½/í˜ì´ìŠ¤ì‰´ë“œ",
        options:["ì¥ê°‘","ìˆ˜ìˆ ë§ˆìŠ¤í¬","ë³´ì•ˆê²½/í˜ì´ìŠ¤ì‰´ë“œ","N95"],
        answer:"ë³´ì•ˆê²½/í˜ì´ìŠ¤ì‰´ë“œ",
        explain:"ë¹„ì‚° ìœ„í—˜ì´ ìˆìœ¼ë©´ ëˆˆ/ì–¼êµ´ ë³´í˜¸(ë³´ì•ˆê²½/í˜ì´ìŠ¤ì‰´ë“œ)ê°€ í•„ìš”í•©ë‹ˆë‹¤."
      },
      {
        type:"ISO",
        title:"ì˜´(Scabies) ì˜ì‹¬ í™˜ì ëŒë´„",
        desc:"í”¼ë¶€ ì ‘ì´‰ìœ¼ë¡œ ì „íŒŒ. ì–´ë–¤ ê²©ë¦¬ì£¼ì˜?",
        key:"ì ‘ì´‰ì£¼ì˜",
        options:["ê³µê¸°ì£¼ì˜","ë¹„ë§ì£¼ì˜","ì ‘ì´‰ì£¼ì˜","í‘œì¤€ì£¼ì˜ë§Œ"],
        answer:"ì ‘ì´‰ì£¼ì˜",
        explain:"ì˜´ì€ ì ‘ì´‰ìœ¼ë¡œ ì „íŒŒë˜ì–´ ì ‘ì´‰ì£¼ì˜ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤."
      },
      {
        type:"PPE",
        title:"VRE/CRE ë“± ë‹¤ì œë‚´ì„±ê·  ì ‘ì´‰ ê´€ë¦¬",
        desc:"í™˜ì/í™˜ê²½ ì ‘ì´‰ì´ ë§ìŒ. ìš°ì„  í•„ìš”í•œ PPEëŠ”?",
        key:"ì¥ê°‘+ê°€ìš´(ìƒí™©ì— ë”°ë¼)",
        options:["ì¥ê°‘","ê°€ìš´","ì¥ê°‘+ê°€ìš´","N95"],
        answer:"ì¥ê°‘+ê°€ìš´",
        explain:"ì ‘ì´‰ì£¼ì˜ ìƒí™©ì—ì„œëŠ” ì¥ê°‘ê³¼ ê°€ìš´ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤(ê¸°ê´€ ì§€ì¹¨ ì¤€ìˆ˜)."
      },
      {
        type:"ISO",
        title:"ìˆ˜ë‘(Varicella) ì˜ì‹¬ í™˜ì",
        desc:"ê³µê¸° ì „íŒŒ + ì ‘ì´‰ ì „íŒŒ. ê²©ë¦¬ì£¼ì˜ëŠ”?",
        key:"ê³µê¸°ì£¼ì˜(+ì ‘ì´‰)",
        options:["ë¹„ë§ì£¼ì˜","ê³µê¸°ì£¼ì˜","ì ‘ì´‰ì£¼ì˜","í‘œì¤€ì£¼ì˜"],
        answer:"ê³µê¸°ì£¼ì˜",
        explain:"ìˆ˜ë‘/íŒŒì¢…ì„± ëŒ€ìƒí¬ì§„ì€ ê³µê¸°ì£¼ì˜(ê·¸ë¦¬ê³  ì ‘ì´‰ì£¼ì˜ ë³‘í–‰)ë¥¼ ê³ ë ¤í•©ë‹ˆë‹¤."
      },
      {
        type:"PPE",
        title:"ê²©ë¦¬ì‹¤ ì¶œì… ì „ ì†ìœ„ìƒ",
        desc:"PPE ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë°˜ë“œì‹œ í•´ì•¼ í•˜ëŠ” ê²ƒì€?",
        key:"ì†ìœ„ìƒ",
        options:["ì¥ê°‘ ì°©ìš©","ì†ìœ„ìƒ","ìˆ˜ìˆ ë§ˆìŠ¤í¬ ì°©ìš©","ê°€ìš´ ì°©ìš©"],
        answer:"ì†ìœ„ìƒ",
        explain:"ì†ìœ„ìƒì€ í‘œì¤€ì£¼ì˜ í•µì‹¬ì´ë©° ëª¨ë“  ìƒí™©ì˜ ê¸°ë³¸ì…ë‹ˆë‹¤."
      },
      {
        type:"PPE",
        title:"í™˜ì í™œë ¥ì§•í›„ ì¸¡ì •",
        desc:"ì²´ì•¡ ë…¸ì¶œ ì—†ê³  ì ‘ì´‰ ìµœì†Œ. í•„ìš”í•œ ì¡°ì¹˜ëŠ”?",
        key:"PPE ë¶ˆí•„ìš”(ì†ìœ„ìƒ ì¤‘ì‹¬)",
        options:["ì¥ê°‘","ê°€ìš´","N95","PPE ë¶ˆí•„ìš”"],
        answer:"PPE ë¶ˆí•„ìš”",
        explain:"ë…¸ì¶œ ìœ„í—˜ì´ ì—†ìœ¼ë©´ í‘œì¤€ì£¼ì˜(ì†ìœ„ìƒ ì¤‘ì‹¬)ë¡œ ì¶©ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      },
      {
        type:"ISO",
        title:"êµ¬í† /ì„¤ì‚¬(ë…¸ë¡œë°”ì´ëŸ¬ìŠ¤ ì˜ì‹¬)",
        desc:"í™˜ê²½ ì˜¤ì—¼/ì ‘ì´‰ ì „íŒŒ ì¤‘ìš”. ì–´ë–¤ ê²©ë¦¬ì£¼ì˜?",
        key:"ì ‘ì´‰ì£¼ì˜",
        options:["ì ‘ì´‰ì£¼ì˜","ê³µê¸°ì£¼ì˜","ë¹„ë§ì£¼ì˜","í‘œì¤€ì£¼ì˜ë§Œ"],
        answer:"ì ‘ì´‰ì£¼ì˜",
        explain:"ë…¸ë¡œ ë“±ì€ ì ‘ì´‰/í™˜ê²½ ì˜¤ì—¼ ê´€ë¦¬ê°€ í•µì‹¬ì´ë¼ ì ‘ì´‰ì£¼ì˜ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤."
      },
    ];

    // ====== ìƒíƒœ ======
    const TOTAL = 10;
    let order = [];
    let idx = 0;
    let score = 0;
    let ok = 0;
    let bad = 0;
    let streak = 0;
    let locked = false;

    const $ = (id)=>document.getElementById(id);
    const stageTxt = $("stageTxt");
    const scoreTxt = $("scoreTxt");
    const bestTxt  = $("bestTxt");
    const okCnt = $("okCnt");
    const badCnt = $("badCnt");
    const streakCnt = $("streakCnt");
    const qTitle = $("qTitle");
    const qDesc = $("qDesc");
    const qTypeBadge = $("qTypeBadge");
    const qKeyBadge = $("qKeyBadge");
    const choices = $("choices");
    const msg = $("msg");
    const charEl = $("char");
    const btnNext = $("btnNext");
    const btnReset = $("btnReset");
    const overlay = $("overlay");
    const btnStart = $("btnStart");
    const nameInput = $("nameInput");
    const userTxt = $("userTxt");

    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function loadBest(){
      const best = Number(localStorage.getItem("ppe_best")||"0");
      bestTxt.textContent = best;
      return best;
    }
    function saveBestIfNeeded(){
      const best = loadBest();
      if(score > best){
        localStorage.setItem("ppe_best", String(score));
        bestTxt.textContent = score;
      }
    }

    function setChar(state){
      charEl.setAttribute("data-state", state);
    }

    function setMsg(kind, text){
      msg.className = "msg" + (kind ? (" " + kind) : "");
      msg.textContent = text || "";
    }

    function renderMeta(){
      stageTxt.textContent = `ë¬¸í•­ ${idx+1} / ${TOTAL}`;
      scoreTxt.textContent = score;
      okCnt.textContent = ok;
      badCnt.textContent = bad;
      streakCnt.textContent = streak;
      loadBest();
    }

    function currentQ(){
      return QUESTIONS[order[idx]];
    }

    function renderQ(){
      locked = false;
      setChar("idle");
      setMsg("", "");
      btnNext.textContent = (idx === TOTAL-1) ? "ê²°ê³¼" : "ë‹¤ìŒ";

      const q = currentQ();
      qTitle.textContent = q.title;
      qDesc.textContent = q.desc;

      if(q.type === "PPE"){
        qTypeBadge.textContent = "PPE";
        qKeyBadge.textContent = "ë³´í˜¸êµ¬ ì„ íƒ";
      }else{
        qTypeBadge.textContent = "ê²©ë¦¬ìœ í˜•";
        qKeyBadge.textContent = "ì£¼ì˜ ì„ íƒ";
      }

      // ì˜µì…˜ ì„ê¸°
      const opts = shuffle(q.options);
      choices.innerHTML = "";
      opts.forEach(opt=>{
        const b = document.createElement("button");
        b.className = "btn";
        b.type = "button";

        // ë²„íŠ¼ ì•„ë˜ ì‘ì€ íŒíŠ¸(ì‚¼ì„±ë³‘ì› ìŠ¤íƒ€ì¼ ëŠë‚Œ)
        let sub = "";
        if(q.type==="PPE"){
          if(opt==="ì¥ê°‘") sub="ì²´ì•¡/ì ‘ì´‰";
          if(opt==="ê°€ìš´") sub="ì˜¤ì—¼/ì ‘ì´‰";
          if(opt==="ìˆ˜ìˆ ë§ˆìŠ¤í¬") sub="ë¹„ë§";
          if(opt==="N95") sub="ê³µê¸°";
          if(opt==="ë³´ì•ˆê²½/í˜ì´ìŠ¤ì‰´ë“œ") sub="íŠ€ê¹€";
          if(opt==="PPE ë¶ˆí•„ìš”") sub="ì†ìœ„ìƒ ì¤‘ì‹¬";
          if(opt==="ì†ìœ„ìƒ") sub="ê¸°ë³¸";
        }else{
          if(opt==="í‘œì¤€ì£¼ì˜") sub="ê¸°ë³¸";
          if(opt==="ì ‘ì´‰ì£¼ì˜") sub="ì ‘ì´‰/í™˜ê²½";
          if(opt==="ë¹„ë§ì£¼ì˜") sub="ì¹¨ë°©ìš¸";
          if(opt==="ê³µê¸°ì£¼ì˜") sub="ì—ì–´ë¡œì¡¸";
        }

        b.innerHTML = `<div>${opt}</div>${sub?`<small>${sub}</small>`:""}`;
        b.addEventListener("click", ()=>choose(opt));
        choices.appendChild(b);
      });

      renderMeta();
    }

    function choose(opt){
      if(locked) return;
      locked = true;

      const q = currentQ();
      const isCorrect = (opt === q.answer);

      if(isCorrect){
        score += 10;
        ok += 1;
        streak += 1;
        setChar("correct");
        setMsg("ok", "ì •ë‹µ âœ…  " + q.explain);
      }else{
        bad += 1;
        streak = 0;
        setChar("wrong");
        setMsg("bad", `ì˜¤ë‹µ âŒ  ì •ë‹µ: ${q.answer} Â· ${q.explain}`);
      }

      saveBestIfNeeded();
      renderMeta();
    }

    function next(){
      if(!locked){
        setMsg("bad", "ì„ íƒ í›„ ë‹¤ìŒì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
        return;
      }
      if(idx === TOTAL-1){
        // ê²°ê³¼
        if(ok === TOTAL){
          setChar("win");
          setMsg("ok", `ì˜¬í´ë¦¬ì–´! ğŸ‰ ${score}ì `);
        }else{
          setChar("idle");
          setMsg("", `ë! ì ìˆ˜: ${score}ì  (ì •ë‹µ ${ok}/${TOTAL})`);
        }
        btnNext.textContent = "ë‹¤ì‹œí•˜ê¸°";
        btnNext.onclick = restart;
        return;
      }
      idx += 1;
      renderQ();
    }

    function restart(){
      btnNext.onclick = next;
      startGame(true);
    }

    function startGame(keepName){
      // 10ë¬¸í•­ ëœë¤ ë½‘ê¸°
      const pool = [...Array(QUESTIONS.length)].map((_,i)=>i);
      order = shuffle(pool).slice(0, TOTAL);

      idx = 0; score = 0; ok = 0; bad = 0; streak = 0; locked = false;

      // ì´ë¦„ ì €ì¥(ì„ íƒ)
      if(!keepName){
        const nm = (nameInput.value||"").trim();
        localStorage.setItem("ppe_name", nm);
      }
      const savedName = localStorage.getItem("ppe_name") || "";
      userTxt.textContent = "ì´ë¦„: " + (savedName ? savedName : "-");

      overlay.style.display = "none";
      renderQ();
    }

    // ì´ë²¤íŠ¸
    btnNext.addEventListener("click", next);
    btnReset.addEventListener("click", ()=>{
      overlay.style.display = "flex";
      setChar("idle");
      setMsg("", "");
    });
    btnStart.addEventListener("click", ()=>startGame(false));

    // ì´ˆê¸°
    (function init(){
      loadBest();
      const savedName = localStorage.getItem("ppe_name") || "";
      if(savedName) nameInput.value = savedName;
      userTxt.textContent = "ì´ë¦„: " + (savedName ? savedName : "-");
    })();
  </script>
</body>
</html>
