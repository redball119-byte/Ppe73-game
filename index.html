<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>73ë³‘ë™ ê°ì—¼ì°¨ë‹¨ ë¯¸ì…˜</title>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif; margin:0; background:#f6fbff; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 18px; }
    .card { background:#fff; border-radius:16px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,.08); }
    h1 { font-size:22px; margin:0 0 8px; }
    .sub { color:#556; font-size:13px; margin-bottom:12px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .col { flex:1; min-width: 260px; }
    input, select { width:100%; padding:10px 12px; border-radius:12px; border:1px solid #dde; }
    button { width:100%; padding:12px 14px; border-radius:14px; border:0; font-weight:700; cursor:pointer; }
    .btn { background:#2d7ff9; color:#fff; }
    .btn2 { background:#eef4ff; color:#1a3b7a; border:1px solid #d6e6ff; }
    .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }
    .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef7ff; color:#235; font-size:12px; }
    .q { font-size:18px; font-weight:800; margin:8px 0; }
    .desc { color:#556; font-size:14px; line-height:1.4; }
    .char { width:100%; max-width:220px; aspect-ratio:1/1; object-fit:contain; background:#f2f8ff; border-radius:18px; }
    .footer { margin-top:10px; font-size:12px; color:#667; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="screenStart">
      <h1>73ë³‘ë™ ê°ì—¼ì°¨ë‹¨ ë¯¸ì…˜</h1>
      <div class="sub">ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì°¸ì—¬ Â· PPEë¥¼ ì˜¬ë°”ë¥´ê²Œ ì„ íƒí•´ ì ìˆ˜ë¥¼ ì–»ìœ¼ì„¸ìš”</div>
      <div class="row">
        <div class="col">
          <label class="pill">ë‹‰ë„¤ì„(ì‹¤ëª…X ê¶Œì¥)</label>
          <input id="nickname" placeholder="ì˜ˆ: 73A-ë¯¸í¬ / 73N-í™ê¸¸ë™" />
          <div style="height:10px"></div>
          <label class="pill">ê·¼ë¬´</label>
          <select id="shift">
            <option value="Day">Day</option>
            <option value="Evening">Evening</option>
            <option value="Night">Night</option>
          </select>
          <div style="height:12px"></div>
          <button class="btn" id="btnStart">ê²Œì„ ì‹œì‘</button>
          <div class="footer">â€» ì €ì¥ í•­ëª©: ë³‘ë™(73), ë‹‰ë„¤ì„, ê·¼ë¬´, ì ìˆ˜, ì†Œìš”ì‹œê°„, ì¼ì‹œ</div>
        </div>
        <div class="col" style="display:flex; align-items:center; justify-content:center;">
          <img id="charImg" class="char" src="char_idle.png" alt="ìºë¦­í„°" />
        </div>
      </div>
    </div>

    <div class="card hidden" id="screenGame">
      <div class="row">
        <div class="col">
          <span class="pill" id="status"></span>
          <div class="q" id="qTitle"></div>
          <div class="desc" id="qDesc"></div>
          <div style="height:12px"></div>
          <div class="grid" id="choices"></div>
          <div style="height:10px"></div>
          <button class="btn2 hidden" id="btnNext">ë‹¤ìŒ</button>
          <div class="footer" id="feedback"></div>
        </div>
        <div class="col" style="display:flex; align-items:center; justify-content:center;">
          <img id="charImg2" class="char" src="char_idle.png" alt="ìºë¦­í„°" />
        </div>
      </div>
    </div>

    <div class="card hidden" id="screenEnd">
      <h1>ì™„ë£Œ ğŸ‰</h1>
      <div class="sub" id="resultText"></div>
      <button class="btn" id="btnRestart">ë‹¤ì‹œí•˜ê¸°</button>
      <div class="footer">ë°ì´í„°ëŠ” Firebaseì— ì €ì¥ë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- Firebase (Realtime Database) -->
  <script type="module">
    // 1) ì•„ë˜ Firebase configë¥¼ ì½˜ì†”ì—ì„œ ë³µì‚¬í•´ ë„£ìœ¼ì„¸ìš”.
    // Firebase Realtime Database ì›¹ ì‹œì‘ ë¬¸ì„œ ì°¸ê³ . :contentReference[oaicite:6]{index=6}
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 2) ë¬¸í•­(73ë³‘ë™ ê°„í˜¸ì‚¬ PPE ì„ íƒ) â€” í•„ìš”í•˜ë©´ ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ë©´ ë¨
    const PPE = {
      GLOVES: "ì¥ê°‘",
      GOWN: "ê°€ìš´",
      SM: "ìˆ˜ìˆ ë§ˆìŠ¤í¬",
      N95: "N95",
      EYE: "ë³´ì•ˆê²½/í˜ì´ìŠ¤ì‰´ë“œ"
    };

    const questions = [
      { title:"íê²°í•µ ì˜ì‹¬ í™˜ì ë³‘ì‹¤ ì…ì‹¤", desc:"ê¸°ì¹¨/ê°ë‹´, ìŒì•• ê²©ë¦¬ ê³ ë ¤", correct:[PPE.N95], explain:"ê³µê¸°ì£¼ì˜ ì˜ì‹¬ ì‹œ N95(ë˜ëŠ” ë™ê¸‰) ì°©ìš©" },
      { title:"VRE í™˜ì ë“œë ˆì‹±", desc:"ì ‘ì´‰ì£¼ì˜", correct:[PPE.GLOVES, PPE.GOWN], explain:"ì ‘ì´‰ì£¼ì˜: ì¥ê°‘+ê°€ìš´" },
      { title:"ì¸í”Œë£¨ì—”ì ì˜ì‹¬ í™˜ì í¡ì¸(suction)", desc:"ë¹„ë§ ë…¸ì¶œ ê°€ëŠ¥", correct:[PPE.SM, PPE.GLOVES, PPE.GOWN, PPE.EYE], explain:"ë¹„ë§/ë¹„ë§ íŠ€ê¹€: ë§ˆìŠ¤í¬+ì•„ì´ë³´í˜¸ ê³ ë ¤" },
      { title:"í˜ˆì•¡ ì±„í˜ˆ", desc:"í‘œì¤€ì£¼ì˜", correct:[PPE.GLOVES], explain:"ì²´ì•¡ ë…¸ì¶œ ê°€ëŠ¥: ì¥ê°‘" },
      { title:"MRSA í™˜ì ì²´ìœ„ë³€ê²½", desc:"ì ‘ì´‰ì£¼ì˜", correct:[PPE.GLOVES, PPE.GOWN], explain:"ì ‘ì´‰ì£¼ì˜: ì¥ê°‘+ê°€ìš´" },
      { title:"CDI í™˜ì ê¸°ì €ê·€ êµí™˜", desc:"ì ‘ì´‰ì£¼ì˜ + í™˜ê²½ì˜¤ì—¼ ê°€ëŠ¥", correct:[PPE.GLOVES, PPE.GOWN], explain:"ì ‘ì´‰ì£¼ì˜: ì¥ê°‘+ê°€ìš´ (ì†ìœ„ìƒì€ ë¹„ëˆ„+ë¬¼ ê°•ì¡°)" },
      { title:"ì¤‘ì‹¬ì •ë§¥ê´€ ë“œë ˆì‹±", desc:"ë¬´ê·  ìˆ ê¸° ì¤‘ ë¹„ë§ ê°€ëŠ¥", correct:[PPE.GLOVES, PPE.SM], explain:"ë¬´ê·  ìˆ ê¸°: ì¥ê°‘ + ë§ˆìŠ¤í¬ ê¶Œì¥(ê¸°ê´€ ì§€ì¹¨ì— ë§ì¶° ì¡°ì •)" },
      { title:"ì½”ë¡œë‚˜ ì˜ì‹¬ í™˜ì ë„¤ë¶ˆë¼ì´ì €", desc:"ì—ì–´ë¡œì¡¸ ë°œìƒ", correct:[PPE.N95, PPE.GLOVES, PPE.GOWN, PPE.EYE], explain:"ì—ì–´ë¡œì¡¸: N95 + ì•„ì´ë³´í˜¸ + ê°€ìš´/ì¥ê°‘" },
      { title:"ì¼ë°˜ í™˜ì í™œë ¥ì§•í›„ ì¸¡ì •", desc:"ì²´ì•¡ ë…¸ì¶œ ì—†ìŒ", correct:[], explain:"PPE ì—†ì´ ì†ìœ„ìƒ ì¤‘ì‹¬(í•„ìš” ì‹œ ìƒí™© ë”°ë¼ ì¥ê°‘)" },
      { title:"í˜ˆì•¡ ëŒ€ëŸ‰ ì˜¤ì—¼ ì •ë¦¬", desc:"íŠ€ê¹€/ë…¸ì¶œ ìœ„í—˜", correct:[PPE.GLOVES, PPE.GOWN, PPE.SM, PPE.EYE], explain:"íŠ€ê¹€ ê°€ëŠ¥: ì¥ê°‘+ê°€ìš´+ë§ˆìŠ¤í¬+ì•„ì´ë³´í˜¸" }
    ];

    // --- UI ë¡œì§ ---
    const $ = (id) => document.getElementById(id);
    const screenStart = $("screenStart"), screenGame = $("screenGame"), screenEnd = $("screenEnd");
    const btnStart = $("btnStart"), btnNext = $("btnNext"), btnRestart = $("btnRestart");
    const qTitle = $("qTitle"), qDesc = $("qDesc"), choices = $("choices"), feedback = $("feedback"), status = $("status");
    const charImg = $("charImg"), charImg2 = $("charImg2");

    let idx = 0, score = 0, startAt = 0;
    let user = { nickname:"", shift:"", ward:"73ë³‘ë™" };
    let currentPick = new Set();

    const allChoices = [PPE.GLOVES, PPE.GOWN, PPE.SM, PPE.N95, PPE.EYE];

    function show(screen){
      [screenStart, screenGame, screenEnd].forEach(s => s.classList.add("hidden"));
      screen.classList.remove("hidden");
    }

    function setChar(state){
      // íŒŒì¼ëª…ë§Œ ë°”ê¾¸ë©´ ê·€ì—¬ìš´ â€œí‘œì •/ìƒíƒœâ€ ì—°ì¶œ ê°€ëŠ¥
      // char_idle.png / char_good.png / char_bad.png / char_win.png
      const map = {
        idle:"char_idle.png",
        good:"char_good.png",
        bad:"char_bad.png",
        win:"char_win.png"
      };
      charImg.src = map[state] || map.idle;
      charImg2.src = map[state] || map.idle;
    }

    function renderQuestion(){
      currentPick = new Set();
      btnNext.classList.add("hidden");
      feedback.textContent = "";
      setChar("idle");

      const q = questions[idx];
      status.textContent = `ë¬¸í•­ ${idx+1} / ${questions.length} Â· í˜„ì¬ ì ìˆ˜ ${score}`;
      qTitle.textContent = q.title;
      qDesc.textContent = q.desc;

      choices.innerHTML = "";
      allChoices.forEach(label => {
        const b = document.createElement("button");
        b.className = "btn2";
        b.textContent = label;
        b.onclick = () => {
          if (currentPick.has(label)) {
            currentPick.delete(label);
            b.style.opacity = "1";
            b.style.outline = "none";
          } else {
            currentPick.add(label);
            b.style.opacity = "0.85";
            b.style.outline = "2px solid #2d7ff9";
          }
        };
        choices.appendChild(b);
      });

      // ì œì¶œ ë²„íŠ¼(ë‹¤ìŒ ë²„íŠ¼ì„ ì œì¶œë¡œ ì‚¬ìš©)
      btnNext.textContent = "ì œì¶œ";
      btnNext.classList.remove("hidden");
      btnNext.onclick = grade;
    }

    function sameSet(a, bArr){
      const b = new Set(bArr);
      if (a.size !== b.size) return false;
      for (const x of a) if (!b.has(x)) return false;
      return true;
    }

    function grade(){
      const q = questions[idx];
      const ok = sameSet(currentPick, q.correct);
      if (ok) { score += 10; setChar("good"); }
      else { score = Math.max(0, score - 5); setChar("bad"); }

      feedback.textContent = `${ok ? "ì •ë‹µ âœ…" : "ì˜¤ë‹µ âŒ"}  Â· í•´ì„¤: ${q.explain}`;

      // ë‹¤ìŒìœ¼ë¡œ
      btnNext.textContent = (idx === questions.length - 1) ? "ê²°ê³¼ ë³´ê¸°" : "ë‹¤ìŒ";
      btnNext.onclick = () => {
        idx++;
        if (idx >= questions.length) finish();
        else renderQuestion();
      };
    }

    async function finish(){
      setChar("win");
      const durationSec = Math.round((Date.now() - startAt) / 1000);
      const payload = {
        ward: user.ward,
        nickname: user.nickname,
        shift: user.shift,
        score,
        durationSec,
        createdAt: new Date().toISOString()
      };

      // Firebaseì— ê¸°ë¡ ì €ì¥ (pushë¡œ ê³ ìœ  í‚¤ ìƒì„±)
      // Realtime DB ì½ê¸°/ì“°ê¸° ê¸°ë³¸ì€ ë¬¸ì„œ ì°¸ê³ . :contentReference[oaicite:7]{index=7}
      const k = push(ref(db, "ppeGameResults")).key;
      await set(ref(db, `ppeGameResults/${k}`), payload);

      $("resultText").textContent = `ì ìˆ˜: ${score}ì  Â· ì†Œìš”ì‹œê°„: ${durationSec}ì´ˆ (ê¸°ë¡ ì €ì¥ ì™„ë£Œ)`;
      show(screenEnd);
    }

    btnStart.onclick = () => {
      const n = $("nickname").value.trim();
      if (!n) { alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”(ì‹¤ëª…X ê¶Œì¥)"); return; }
      user.nickname = n;
      user.shift = $("shift").value;
      idx = 0; score = 0; startAt = Date.now();
      show(screenGame);
      renderQuestion();
    };

    btnRestart.onclick = () => {
      setChar("idle");
      show(screenStart);
    };
  </script>
</body>
</html>
